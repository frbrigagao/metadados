import{c as e,U as a,d as t,E as s,B as o,R as r,b as l,e as d,f as n,g as i,I as u,J as c,u as p,Q as m,M as f,P as v,H as g,k as h,r as y,au as x,L as b,a0 as _,ah as w,$ as k,af as q,W as M,av as S,l as j,a5 as D,ak as C,j as A,m as E,z as I,y as R,a6 as B,F as $,ac as V,p as P,A as T,D as N}from"./index-DbmskYgF.js";import{R as O,d as U,u as L,w as F,a as H,b as J,c as z,_ as G}from"./xlsx-CkhwWcJv.js";import{e as W,_ as K,a as X,b as Y,c as Q}from"./CardTitle-m65SNR4W.js";import{_ as Z,a as ee}from"./index-BJaoX4NB.js";import{_ as ae,U as te,v as se,a as oe,p as re,b as le,c as de}from"./importHelpers-DMCKqSMq.js";import{e as ne,f as ie,g as ue,h as ce,i as pe,_ as me,a as fe,b as ve,c as ge,d as he}from"./TableRow-BZwG14sz.js";import{V as ye,_ as xe}from"./DialogDescription-D5tDNY3G.js";import{_ as be}from"./Label-CjKkp79l.js";import{u as _e,i as we,C as ke}from"./useFormControl-DzSbP6cc.js";import{T as qe,_ as Me,F as Se}from"./Progress-B_pZHCoN.js";import{_ as je}from"./Separator-D9pSkOyW.js";import{I as De}from"./info-C0BMTRYo.js";import{C as Ce,_ as Ae,a as Ee}from"./TableHeader-C-QkMKMq.js";
/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=e("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),Re=e("file-input",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 15h10",key:"jfw4w8"}],["path",{d:"m9 18 3-3-3-3",key:"112psh"}]]),Be=e("file-json",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]),$e=e("file-output",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4 7V4a2 2 0 0 1 2-2 2 2 0 0 0-2 2",key:"1vk7w2"}],["path",{d:"M4.063 20.999a2 2 0 0 0 2 1L18 22a2 2 0 0 0 2-2V7l-5-5H6",key:"1jink5"}],["path",{d:"m5 11-3 3",key:"1dgrs4"}],["path",{d:"m5 17-3-3h10",key:"1mvvaf"}]]);
/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ve=t({__name:"Radio",props:{id:{type:String,required:!1},value:{type:null,required:!1},disabled:{type:Boolean,required:!1,default:!1},checked:{type:Boolean,required:!1,default:void 0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["update:checked","select"],setup(e,{emit:t}){const g=e,h=t,y=s(g,"checked",h,{passive:void 0===g.checked}),{value:x}=o(g),{forwardRef:b,currentElement:_}=r(),w=_e(_),k=l(()=>g.id&&_.value?document.querySelector(`[for="${g.id}"]`)?.innerText??g.value:void 0);function q(e){g.disabled||function(e,t,s){a("radio.select",s,{originalEvent:e,value:t})}(e,g.value,e=>{h("select",e),e?.defaultPrevented||(y.value=!0,w.value&&e.stopPropagation())})}return(e,a)=>(n(),d(p(v),m(e.$attrs,{id:e.id,ref:p(b),role:"radio",type:"button"===e.as?"button":void 0,as:e.as,"aria-checked":p(y),"aria-label":k.value,"as-child":e.asChild,disabled:e.disabled?"":void 0,"data-state":p(y)?"checked":"unchecked","data-disabled":e.disabled?"":void 0,value:p(x),required:e.required,name:e.name,onClick:f(q,["stop"])}),{default:i(()=>[u(e.$slots,"default",{checked:p(y)}),p(w)&&e.name?(n(),d(p(ye),{key:0,type:"radio",tabindex:"-1",value:p(x),checked:!!p(y),name:e.name,disabled:e.disabled,required:e.required},null,8,["value","checked","name","disabled","required"])):c("v-if",!0)]),_:3},16,["id","type","as","aria-checked","aria-label","as-child","disabled","data-state","data-disabled","value","required","name"]))}});const[Pe,Te]=g("RadioGroupRoot");var Ne=t({__name:"RadioGroupRoot",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},disabled:{type:Boolean,required:!1,default:!1},orientation:{type:String,required:!1,default:void 0},dir:{type:String,required:!1},loop:{type:Boolean,required:!1,default:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1,default:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,l=a,{forwardRef:m,currentElement:f}=r(),g=s(t,"modelValue",l,{defaultValue:t.defaultValue,passive:void 0===t.modelValue}),{disabled:y,loop:x,orientation:b,name:_,required:w,dir:k}=o(t),q=W(k),M=_e(f);return Te({modelValue:g,changeModelValue:e=>{g.value=e},disabled:y,loop:x,orientation:b,name:_?.value,required:w}),(e,a)=>(n(),d(p(O),{"as-child":"",orientation:p(b),dir:p(q),loop:p(x)},{default:i(()=>[h(p(v),{ref:p(m),role:"radiogroup","data-disabled":p(y)?"":void 0,"as-child":e.asChild,as:e.as,"aria-orientation":p(b),"aria-required":p(w),dir:p(q)},{default:i(()=>[u(e.$slots,"default",{modelValue:p(g)}),p(M)&&p(_)?(n(),d(p(ye),{key:0,required:p(w),disabled:p(y),value:p(g),name:p(_)},null,8,["required","disabled","value","name"])):c("v-if",!0)]),_:3},8,["data-disabled","as-child","as","aria-orientation","aria-required","dir"])]),_:3},8,["orientation","dir","loop"]))}});const[Oe,Ue]=g("RadioGroupItem");var Le=t({inheritAttrs:!1,__name:"RadioGroupItem",props:{id:{type:String,required:!1},value:{type:null,required:!1},disabled:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["select"],setup(e,{emit:a}){const t=e,s=a,{forwardRef:o,currentElement:c}=r(),v=Pe(),g=l(()=>v.disabled.value||t.disabled),_=l(()=>v.required.value||t.required),w=l(()=>we(v.modelValue?.value,t.value));Ue({disabled:g,checked:w});const k=y(!1),q=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];function M(){setTimeout(()=>{k.value&&c.value?.click()},0)}return x("keydown",e=>{q.includes(e.key)&&(k.value=!0)}),x("keyup",()=>{k.value=!1}),(e,a)=>(n(),d(p(U),{checked:w.value,disabled:g.value,"as-child":"",focusable:!g.value,active:w.value},{default:i(()=>[h(Ve,m({...e.$attrs,...t},{ref:p(o),checked:w.value,required:_.value,disabled:g.value,"onUpdate:checked":a[0]||(a[0]=a=>p(v).changeModelValue(e.value)),onSelect:a[1]||(a[1]=e=>s("select",e)),onKeydown:a[2]||(a[2]=b(f(()=>{},["prevent"]),["enter"])),onFocus:M}),{default:i(()=>[u(e.$slots,"default",{checked:w.value,required:_.value,disabled:g.value})]),_:3},16,["checked","required","disabled"])]),_:3},8,["checked","disabled","focusable","active"]))}}),Fe=t({__name:"RadioGroupIndicator",props:{forceMount:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(e){const{forwardRef:a}=r(),t=Oe();return(e,s)=>(n(),d(p(_),{present:e.forceMount||p(t).checked.value},{default:i(()=>[h(p(v),m({ref:p(a),"data-state":p(t).checked.value?"checked":"unchecked","data-disabled":p(t).disabled.value?"":void 0,"as-child":e.asChild,as:e.as},e.$attrs),{default:i(()=>[u(e.$slots,"default")]),_:3},16,["data-state","data-disabled","as-child","as"])]),_:3},8,["present"]))}});const He={__name:"RadioGroup",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},disabled:{type:Boolean,required:!1},orientation:{type:String,required:!1},dir:{type:String,required:!1},loop:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1},class:{type:null,required:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,s=a,o=w(t,"class"),r=k(o,s);return(e,a)=>(n(),d(p(Ne),m({class:p(q)("grid gap-2",t.class)},p(r)),{default:i(()=>[u(e.$slots,"default")]),_:3},16,["class"]))}},Je={__name:"RadioGroupItem",props:{id:{type:String,required:!1},value:{type:null,required:!1},disabled:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1},class:{type:null,required:!1}},setup(e){const a=e,t=w(a,"class"),s=M(t);return(e,t)=>(n(),d(p(Le),m(p(s),{class:p(q)("peer aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a.class)}),{default:i(()=>[h(p(Fe),{class:"flex items-center justify-center"},{default:i(()=>[h(p(ke),{class:"h-3.5 w-3.5 text-primary"})]),_:1})]),_:1},16,["class"]))}};function ze(e){if(!e)return"Data desconhecida";const a=new Date(e);return`${String(a.getDate()).padStart(2,"0")}/${String(a.getMonth()+1).padStart(2,"0")}/${a.getFullYear()} às ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`}const Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},We={class:"flex items-center gap-2 text-sm text-muted-foreground"},Ke={key:0,class:"space-y-4 py-4"},Xe={class:"rounded-lg border p-4 space-y-2"},Ye={class:"grid grid-cols-2 gap-2 text-sm"},Qe={class:"font-semibold"},Ze={class:"text-sm space-y-1"},ea={class:"flex justify-between"},aa={class:"font-medium"},ta={class:"flex justify-between"},sa={class:"font-medium"},oa={class:"flex justify-between"},ra={class:"font-medium"},la={class:"flex justify-between"},da={class:"font-medium"},na={class:"flex justify-between"},ia={class:"font-medium"},ua={class:"flex justify-between"},ca={class:"font-medium"},pa={class:"space-y-3"},ma={class:"flex-1"},fa={class:"flex-1"},va={class:"space-y-4 py-4"},ga={class:"text-center text-sm text-muted-foreground"},ha={__name:"BackupCard",setup(e){const{exportAll:a,importAll:t,clearAll:s}=S(),o=j(),r=D(),l=C(),u=y(null),m=y(!1),f=y(!1),v=y(!1),g=y("merge"),x=y(null),b=y(null),_=y({current:0,total:0});async function w(){try{V.info("Preparando backup...");const e=await a(),t={version:"1.0",exportDate:(new Date).toISOString(),appVersion:"4.0",totalRecords:{metadados:e.metadados.length,config:e.config.length,classesProcessuais:e.classesProcessuais.length,tiposDocumentosImportados:e.tiposDocumentosImportados.length,history:e.history.length,tags:e.tags.length},data:e},s=JSON.stringify(t,null,2),o=new Blob([s],{type:"application/json"}),r=function(e){if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["Bytes","KB","MB","GB"][a]}(o.size),l=URL.createObjectURL(o),d=document.createElement("a");d.href=l,d.download=function(){const e=new Date;return`backup-metadados-${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}-${String(e.getHours()).padStart(2,"0")}${String(e.getMinutes()).padStart(2,"0")}${String(e.getSeconds()).padStart(2,"0")}.json`}(),d.click(),URL.revokeObjectURL(l);const n=Object.values(t.totalRecords).reduce((e,a)=>e+a,0);V.success(`Backup exportado com sucesso! ${n} registros (${r})`)}catch(e){V.error("Erro ao exportar backup: "+e.message)}}function k(){u.value?.click()}async function q(e){const a=e.target.files?.[0];if(a)try{v.value=!0;try{se(a)}catch(t){return V.error(t.message),v.value=!1,void(u.value&&(u.value.value=""))}V.info("Lendo arquivo de backup...");const e=await a.text(),s=JSON.parse(e),o=function(e){try{return e&&"object"==typeof e?e.version?e.data&&"object"==typeof e.data?["metadados","config","history","tags"].some(a=>e.data[a]&&Array.isArray(e.data[a]))?{valid:!0}:{valid:!1,error:"Nenhuma tabela válida encontrada no backup"}:{valid:!1,error:"Dados do backup não encontrados"}:{valid:!1,error:"Versão do backup não encontrada"}:{valid:!1,error:"Arquivo inválido"}}catch(t){return{valid:!1,error:"Erro ao validar backup: "+t.message}}}(s);if(!o.valid)return void V.error(o.error);x.value=function(e){if(!e||!e.data)return null;const a={version:e.version||"Desconhecida",exportDate:e.exportDate?new Date(e.exportDate):null,appVersion:e.appVersion||"Desconhecida",totalRecords:{metadados:e.data.metadados?.length||0,config:e.data.config?.length||0,classesProcessuais:e.data.classesProcessuais?.length||0,tiposDocumentosImportados:e.data.tiposDocumentosImportados?.length||0,history:e.data.history?.length||0,tags:e.data.tags?.length||0}};return a.total=Object.values(a.totalRecords).reduce((e,a)=>e+a,0),a}(s),b.value=s,g.value="merge",m.value=!0,u.value&&(u.value.value="")}catch(t){V.error("Erro ao ler arquivo: "+t.message)}finally{v.value=!1}}function M(){m.value=!1,x.value=null,b.value=null,g.value="merge"}async function P(){if(b.value)try{v.value=!0,m.value=!1,f.value=!0;const e=x.value.total;_.value={current:0,total:e},"replace"===g.value&&(V.info("Criando backup de segurança..."),await w(),V.info("Limpando banco de dados..."),await s()),V.info("Importando dados...");const a=b.value.data,d=["metadados","config","classesProcessuais","tiposDocumentosImportados","history","tags"];let n=0;for(const t of d)a[t]&&a[t].length>0&&(_.value.current=n,await new Promise(e=>setTimeout(e,200))),n+=a[t]?.length||0;await t(a),_.value.current=e,V.info("Atualizando interface..."),await Promise.all([r.loadConfig(),r.loadClassesProcessuais(),r.loadTiposDocumentosImportados(),o.loadMetadados(),l.loadHistory()]),f.value=!1;const i="replace"===g.value?"substituídos":"mesclados";V.success(`Backup importado com sucesso! ${e} registros ${i}`),x.value=null,b.value=null,g.value="merge"}catch(e){f.value=!1,V.error("Erro ao importar backup: "+e.message)}finally{v.value=!1}}return(e,a)=>(n(),A($,null,[h(p(X),null,{default:i(()=>[h(p(K),{class:"space-y-6 pt-6"},{default:i(()=>[h(p(Z),null,{default:i(()=>[h(p(De),{class:"w-4 h-4"}),h(p(ae),null,{default:i(()=>[...a[5]||(a[5]=[I("O backup completo inclui",-1)])]),_:1}),h(p(ee),null,{default:i(()=>[...a[6]||(a[6]=[E("ul",{class:"list-disc pl-4 space-y-1 mt-2"},[E("li",null,"Todos os metadados cadastrados"),E("li",null,"Configurações (unidades, tipos de documento, formatos)"),E("li",null,"Classes processuais (se carregadas)"),E("li",null,"Tipos de documentos importados (se importados)"),E("li",null,"Histórico completo de alterações"),E("li",null,"Tags (se existirem)")],-1)])]),_:1})]),_:1}),E("div",Ge,[h(p(X),{class:"cursor-pointer transition-all hover:bg-accent",onClick:w},{default:i(()=>[h(p(K),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:i(()=>[h(p(Ie),{class:"w-12 h-12 text-muted-foreground"}),a[7]||(a[7]=E("div",{class:"text-lg font-semibold"},"Exportar Backup",-1)),a[8]||(a[8]=E("div",{class:"text-sm text-muted-foreground text-center"}," Salvar cópia completa do banco de dados ",-1))]),_:1})]),_:1}),h(p(X),{class:"cursor-pointer transition-all hover:bg-accent",onClick:k},{default:i(()=>[h(p(K),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:i(()=>[h(p(te),{class:"w-12 h-12 text-muted-foreground"}),a[9]||(a[9]=E("div",{class:"text-lg font-semibold"},"Importar Backup",-1)),a[10]||(a[10]=E("div",{class:"text-sm text-muted-foreground text-center"}," Restaurar dados de um backup anterior ",-1))]),_:1})]),_:1})]),E("input",{ref_key:"fileInputRef",ref:u,type:"file",accept:".json",class:"hidden",onChange:q},null,544),h(p(je)),E("div",We,[h(p(Ce),{class:"w-4 h-4"}),a[11]||(a[11]=I(" Formato: JSON com todas as tabelas do banco de dados ",-1))])]),_:1})]),_:1}),h(p(pe),{open:m.value,"onUpdate:open":a[3]||(a[3]=e=>m.value=e)},{default:i(()=>[h(p(ne),{class:"max-w-2xl"},{default:i(()=>[h(p(ie),null,{default:i(()=>[h(p(ue),null,{default:i(()=>[...a[12]||(a[12]=[I("Importar Backup Completo",-1)])]),_:1}),h(p(xe),null,{default:i(()=>[...a[13]||(a[13]=[I(" Escolha como deseja importar os dados do backup ",-1)])]),_:1})]),_:1}),x.value?(n(),A("div",Ke,[E("div",Xe,[a[23]||(a[23]=E("div",{class:"font-semibold"},"Informações do Backup",-1)),E("div",Ye,[a[14]||(a[14]=E("div",{class:"text-muted-foreground"},"Data do backup:",-1)),E("div",null,R(p(ze)(x.value.exportDate)),1),a[15]||(a[15]=E("div",{class:"text-muted-foreground"},"Versão:",-1)),E("div",null,R(x.value.version),1),a[16]||(a[16]=E("div",{class:"text-muted-foreground"},"Total de registros:",-1)),E("div",Qe,R(x.value.total),1)]),h(p(je),{class:"my-3"}),E("div",Ze,[E("div",ea,[a[17]||(a[17]=E("span",{class:"text-muted-foreground"},"Metadados:",-1)),E("span",aa,R(x.value.totalRecords.metadados),1)]),E("div",ta,[a[18]||(a[18]=E("span",{class:"text-muted-foreground"},"Configurações:",-1)),E("span",sa,R(x.value.totalRecords.config),1)]),E("div",oa,[a[19]||(a[19]=E("span",{class:"text-muted-foreground"},"Classes Processuais:",-1)),E("span",ra,R(x.value.totalRecords.classesProcessuais),1)]),E("div",la,[a[20]||(a[20]=E("span",{class:"text-muted-foreground"},"Tipos de Documentos Importados:",-1)),E("span",da,R(x.value.totalRecords.tiposDocumentosImportados),1)]),E("div",na,[a[21]||(a[21]=E("span",{class:"text-muted-foreground"},"Histórico:",-1)),E("span",ia,R(x.value.totalRecords.history),1)]),E("div",ua,[a[22]||(a[22]=E("span",{class:"text-muted-foreground"},"Tags:",-1)),E("span",ca,R(x.value.totalRecords.tags),1)])])]),E("div",pa,[h(p(be),null,{default:i(()=>[...a[24]||(a[24]=[I("Modo de Importação",-1)])]),_:1}),h(p(He),{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=e=>g.value=e)},{default:i(()=>[E("div",{class:"flex items-start space-x-3 rounded-lg border p-4 cursor-pointer hover:bg-accent",onClick:a[0]||(a[0]=e=>g.value="merge")},[h(p(Je),{value:"merge",id:"merge"}),E("div",ma,[h(p(be),{for:"merge",class:"cursor-pointer font-semibold"},{default:i(()=>[...a[25]||(a[25]=[I(" Mesclar Dados ",-1)])]),_:1}),a[26]||(a[26]=E("p",{class:"text-sm text-muted-foreground mt-1"}," Adiciona novos registros e atualiza os existentes. Nenhum dado será removido. ",-1))])]),E("div",{class:"flex items-start space-x-3 rounded-lg border p-4 cursor-pointer hover:bg-accent",onClick:a[1]||(a[1]=e=>g.value="replace")},[h(p(Je),{value:"replace",id:"replace"}),E("div",fa,[h(p(be),{for:"replace",class:"cursor-pointer font-semibold text-destructive"},{default:i(()=>[...a[27]||(a[27]=[I(" Substituir Tudo ",-1)])]),_:1}),a[28]||(a[28]=E("p",{class:"text-sm text-muted-foreground mt-1"}," Remove todos os dados atuais e substitui pelos dados do backup. Esta ação é irreversível! ",-1))])])]),_:1},8,["modelValue"])]),"replace"===g.value?(n(),d(p(Z),{key:0,variant:"destructive"},{default:i(()=>[h(p(Ce),{class:"w-4 h-4"}),h(p(ae),null,{default:i(()=>[...a[29]||(a[29]=[I("ATENÇÃO: Ação Irreversível!",-1)])]),_:1}),h(p(ee),null,{default:i(()=>[...a[30]||(a[30]=[I(" Todos os dados atuais serão permanentemente apagados, incluindo metadados, configurações e histórico. Recomendamos fazer um backup antes de prosseguir. ",-1)])]),_:1})]),_:1})):c("",!0)])):c("",!0),h(p(ce),null,{default:i(()=>[h(p(B),{variant:"outline",onClick:M},{default:i(()=>[...a[31]||(a[31]=[I(" Cancelar ",-1)])]),_:1}),"merge"===g.value?(n(),d(p(B),{key:0,onClick:P,disabled:v.value},{default:i(()=>[h(p(te),{class:"w-4 h-4 mr-2"}),a[32]||(a[32]=I(" Confirmar Mesclagem ",-1))]),_:1},8,["disabled"])):(n(),d(p(B),{key:1,variant:"destructive",onClick:P,disabled:v.value},{default:i(()=>[h(p(qe),{class:"w-4 h-4 mr-2"}),a[33]||(a[33]=I(" Sim, Substituir Tudo ",-1))]),_:1},8,["disabled"]))]),_:1})]),_:1})]),_:1},8,["open"]),h(p(pe),{open:f.value,"onUpdate:open":a[4]||(a[4]=e=>f.value=e),closable:!1},{default:i(()=>[h(p(ne),{class:"max-w-md"},{default:i(()=>[h(p(ie),null,{default:i(()=>[h(p(ue),null,{default:i(()=>[...a[34]||(a[34]=[I("Importando Backup",-1)])]),_:1}),h(p(xe),null,{default:i(()=>[...a[35]||(a[35]=[I(" Por favor, aguarde enquanto os dados são importados... ",-1)])]),_:1})]),_:1}),E("div",va,[a[36]||(a[36]=E("div",{class:"flex items-center justify-center"},[E("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"})],-1)),E("div",ga," Importando "+R(_.value.current)+" de "+R(_.value.total)+" registros... ",1),h(p(Me),{value:_.value.current/_.value.total*100},null,8,["value"])])]),_:1})]),_:1},8,["open"])],64))}},ya={class:"flex items-center gap-2"},xa={key:0},ba={class:"border rounded-md max-h-[300px] overflow-auto"},_a={key:0},wa={key:1},ka={key:0,class:"text-sm text-muted-foreground mt-2"},qa={key:1,class:"space-y-2"},Ma={class:"list-disc pl-4 space-y-1"},Sa={key:0,class:"text-xs mt-2"},ja={class:"list-disc pl-4 space-y-1"},Da={key:0,class:"text-xs mt-2"},Ca={class:"flex items-center gap-2 text-sm text-muted-foreground"},Aa={__name:"ImportCard",setup(e){const a=j(),t=y(null),s=y(null),o=y([]),r=y(null),l=y(!1);async function u(e){const a=e.target.files?.[0];if(a){s.value=a,o.value=[],r.value=null;try{l.value=!0;try{se(a)}catch(t){throw new Error(t.message)}const e=5242880;if(a.size>e)throw new Error(`Arquivo muito grande (max ${e/1024/1024}MB). Arquivo atual: ${(a.size/1024/1024).toFixed(2)}MB`);const s=a.name.split(".").pop().toLowerCase(),d=1e4;if("csv"===s){const e=(await m(a)).split("\n").filter(e=>e.trim());if(e.length>d+1)throw new Error(`Arquivo CSV muito grande (max ${d} registros). Arquivo contém aproximadamente: ${e.length-1} linhas`)}else if("json"===s){const e=(await m(a)).match(/\{[^}]*\}/g);if(e&&e.length>d)throw new Error(`Arquivo JSON muito grande (max ${d} registros). Arquivo contém aproximadamente: ${e.length} objetos`)}const n=await async function(e){const a=e.name.split(".").pop().toLowerCase();return new Promise((t,s)=>{const o=new FileReader;o.onload=async e=>{try{let o;if("csv"===a)o=re(e.target.result);else if("xlsx"===a||"xls"===a)o=le(e.target.result);else{if("json"!==a)return void s(new Error("Formato de arquivo não suportado"));o=de(e.target.result)}t(o)}catch(o){s(o)}},o.onerror=()=>s(new Error("Erro ao ler arquivo")),"xlsx"===a||"xls"===a?o.readAsArrayBuffer(e):o.readAsText(e)})}(a),i=1e4;if(n.length>i)throw new Error(`Muitos registros (max ${i}). Arquivo contém: ${n.length}`);o.value=n,r.value=oe(n)}catch(d){V.error("Erro ao ler arquivo: "+d.message)}finally{l.value=!1}}}async function m(e){return new Promise((a,t)=>{const s=new FileReader;s.onload=e=>a(e.target.result),s.onerror=()=>t(new Error("Erro ao ler arquivo")),s.readAsText(e)})}async function f(){if(o.value.length)if(r.value?.errors.length>0)V.error("Corrija os erros antes de importar");else try{l.value=!0;for(const e of o.value)await a.addMetadado(e);V.success(`${o.value.length} registros importados com sucesso!`),t.value&&(t.value.value=""),s.value=null,o.value=[],r.value=null}catch(e){V.error("Erro ao importar: "+e.message)}finally{l.value=!1}else V.error("Nenhum dado para importar")}return(e,a)=>(n(),d(p(X),null,{default:i(()=>[h(p(Y),null,{default:i(()=>[h(p(Q),{class:"flex items-center gap-2"},{default:i(()=>[h(p(Re),{class:"w-5 h-5"}),a[0]||(a[0]=I(" Importar Dados ",-1))]),_:1})]),_:1}),h(p(K),{class:"space-y-4"},{default:i(()=>[h(p(Z),{variant:"warning"},{default:i(()=>[h(p(Ce),{class:"w-4 h-4"}),h(p(ae),null,{default:i(()=>[...a[1]||(a[1]=[I("Atenção",-1)])]),_:1}),h(p(ee),null,{default:i(()=>[...a[2]||(a[2]=[I(" A importação irá adicionar os novos registros aos existentes. Para substituir todos os dados, limpe o banco antes. ",-1)])]),_:1})]),_:1}),E("div",ya,[h(p(me),{ref_key:"fileInputRef",ref:t,type:"file",accept:".csv,.xlsx,.xls,.json",disabled:l.value,onChange:u,class:"flex-1"},null,8,["disabled"]),h(p(B),{disabled:!s.value||l.value,onClick:f},{default:i(()=>[h(p(te),{class:"w-4 h-4 mr-2"}),a[3]||(a[3]=I(" Importar ",-1))]),_:1},8,["disabled"])]),o.value.length>0?(n(),A("div",xa,[h(p(X),null,{default:i(()=>[h(p(Y),null,{default:i(()=>[h(p(Q),{class:"text-lg"},{default:i(()=>[I(" Pré-visualização ("+R(o.value.length)+" registros) ",1)]),_:1})]),_:1}),h(p(K),null,{default:i(()=>[E("div",ba,[h(p(fe),null,{default:i(()=>[h(p(Ae),null,{default:i(()=>[h(p(ve),null,{default:i(()=>[h(p(Ee),null,{default:i(()=>[...a[4]||(a[4]=[I("Unidade",-1)])]),_:1}),h(p(Ee),null,{default:i(()=>[...a[5]||(a[5]=[I("Tipo Documento",-1)])]),_:1}),h(p(Ee),null,{default:i(()=>[...a[6]||(a[6]=[I("Nome Metadado",-1)])]),_:1}),h(p(Ee),null,{default:i(()=>[...a[7]||(a[7]=[I("Tipo",-1)])]),_:1})]),_:1})]),_:1}),h(p(ge),null,{default:i(()=>[(n(!0),A($,null,P(o.value.slice(0,10),(e,a)=>(n(),d(p(ve),{key:a},{default:i(()=>[h(p(he),null,{default:i(()=>[I(R(e.unidade),1)]),_:2},1024),h(p(he),null,{default:i(()=>[Array.isArray(e.tipoDocumento)?(n(),A("span",_a,R(e.tipoDocumento.join(", ")),1)):(n(),A("span",wa,R(e.tipoDocumento),1))]),_:2},1024),h(p(he),null,{default:i(()=>[I(R(e.nomeMetadado),1)]),_:2},1024),h(p(he),null,{default:i(()=>[I(R(e.tipoMetadados),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),o.value.length>10?(n(),A("p",ka," Mostrando 10 de "+R(o.value.length)+" registros ",1)):c("",!0)]),_:1})]),_:1})])):c("",!0),r.value?(n(),A("div",qa,[r.value.errors.length>0?(n(),d(p(Z),{key:0,variant:"destructive"},{default:i(()=>[h(p(Ce),{class:"w-4 h-4"}),h(p(ae),null,{default:i(()=>[I(R(r.value.errors.length)+" "+R(1===r.value.errors.length?"erro encontrado":"erros encontrados"),1)]),_:1}),h(p(ee),null,{default:i(()=>[E("ul",Ma,[(n(!0),A($,null,P(r.value.errors.slice(0,5),(e,a)=>(n(),A("li",{key:a},R(e),1))),128))]),r.value.errors.length>5?(n(),A("p",Sa," ... e mais "+R(r.value.errors.length-5)+" erros ",1)):c("",!0)]),_:1})]),_:1})):c("",!0),r.value.warnings.length>0?(n(),d(p(Z),{key:1,variant:"warning"},{default:i(()=>[h(p(Ce),{class:"w-4 h-4"}),h(p(ae),null,{default:i(()=>[I(R(r.value.warnings.length)+" "+R(1===r.value.warnings.length?"aviso":"avisos"),1)]),_:1}),h(p(ee),null,{default:i(()=>[E("ul",ja,[(n(!0),A($,null,P(r.value.warnings.slice(0,3),(e,a)=>(n(),A("li",{key:a},R(e),1))),128))]),r.value.warnings.length>3?(n(),A("p",Da," ... e mais "+R(r.value.warnings.length-3)+" avisos ",1)):c("",!0)]),_:1})]),_:1})):c("",!0)])):c("",!0),h(p(je)),E("div",Ca,[h(p(De),{class:"w-4 h-4"}),a[8]||(a[8]=I(" Formatos suportados: CSV, Excel (.xlsx, .xls), JSON ",-1))])]),_:1})]),_:1}))}};function Ea(e){let a=e.toString();return["=","+","-","@","\t","\r","\n"].some(e=>a.startsWith(e))&&(a="'"+a),a=a.replace(/"/g,'""'),`"${a}"`}function Ia(e){if(null==e)return"";const a=String(e);return["=","+","-","@","\t","\r","\n"].some(e=>a.startsWith(e))?"'"+a:a}const Ra={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ba={class:"flex items-center gap-2 text-sm text-muted-foreground"},$a={__name:"ExportCard",setup(e){const a=j();async function t(e){try{const t=a.metadados;if(0===t.length)return void V.error("Não há dados para exportar");switch(e){case"csv":!function(e){const a=e.map(e=>[e.unidade||"",e.metadadoDeProcesso?"Sim":"Não",e.classeProcessual||"Não informado",Array.isArray(e.tipoDocumento)?e.tipoDocumento.join(";"):e.tipoDocumento||"",e.nomeMetadado||"",e.objetivoMetadado||"",e.formatoMetadado||"",e.admiteMultiplos?"Sim":"Não",e.tipoMetadados||"",e.versaoInicialAtende||"",e.observacao||""]);let t=["Unidade","Metadado de Processo","Classe Processual","Tipo de Documento","Nome do Metadado","Objetivo","Formato","Admite Múltiplos","Tipo de Metadados","Versão Inicial Atende","Observação"].map(Ea).join(",")+"\n";a.forEach(e=>{t+=e.map(Ea).join(",")+"\n"});const s=new Blob([t],{type:"text/csv;charset=utf-8;"}),o=document.createElement("a");o.href=URL.createObjectURL(s),o.download=`metadados_${(new Date).toISOString().split("T")[0]}.csv`,o.click()}(t),V.success(`${t.length} registros exportados para CSV`);break;case"excel":!function(e){const a=e.map(e=>({Unidade:Ia(e.unidade),"Metadado de Processo":e.metadadoDeProcesso?"Sim":"Não","Classe Processual":Ia(e.classeProcessual||"Não informado"),"Tipo de Documento":Ia(Array.isArray(e.tipoDocumento)?e.tipoDocumento.join(";"):e.tipoDocumento),"Nome do Metadado":Ia(e.nomeMetadado),Objetivo:Ia(e.objetivoMetadado),Formato:Ia(e.formatoMetadado),"Admite Múltiplos":e.admiteMultiplos?"Sim":"Não","Tipo de Metadados":Ia(e.tipoMetadados),"Versão Inicial Atende":Ia(e.versaoInicialAtende),"Observação":Ia(e.observacao)})),t=L.json_to_sheet(a);t["!cols"]=[{wch:15},{wch:20},{wch:35},{wch:30},{wch:30},{wch:40},{wch:20},{wch:18},{wch:18},{wch:22},{wch:40}];const s=[];e.forEach(e=>{(Array.isArray(e.tipoDocumento)?e.tipoDocumento:e.tipoDocumento?[e.tipoDocumento]:["Não especificado"]).forEach(a=>{s.push({"Tipo de Documento":Ia(a),"Nome do Metadado":Ia(e.nomeMetadado),Unidade:Ia(e.unidade),Objetivo:Ia(e.objetivoMetadado),Formato:Ia(e.formatoMetadado),"Admite Múltiplos":e.admiteMultiplos?"Sim":"Não","Tipo de Metadados":Ia(e.tipoMetadados),"Metadado de Processo":e.metadadoDeProcesso?"Sim":"Não","Versão Inicial Atende":Ia(e.versaoInicialAtende),"Observação":Ia(e.observacao),"Classe Processual":Ia(e.classeProcessual||"Não informado")})})}),s.sort((e,a)=>{const t=e["Tipo de Documento"].localeCompare(a["Tipo de Documento"]);return 0!==t?t:e["Nome do Metadado"].localeCompare(a["Nome do Metadado"])});const o=L.json_to_sheet(s);o["!cols"]=[{wch:35},{wch:30},{wch:15},{wch:40},{wch:20},{wch:18},{wch:18},{wch:20},{wch:22},{wch:40},{wch:35}];const r=L.book_new();L.book_append_sheet(r,t,"Metadados"),L.book_append_sheet(r,o,"Por Tipo de Documento"),F(r,`metadados_${(new Date).toISOString().split("T")[0]}.xlsx`)}(t),V.success(`${t.length} registros exportados para Excel`);break;case"json":!function(e){const a=JSON.stringify(e,null,2),t=new Blob([a],{type:"application/json"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download=`metadados_${(new Date).toISOString().split("T")[0]}.json`,s.click()}(t),V.success(`${t.length} registros exportados para JSON`)}}catch(t){V.error("Erro ao exportar: "+t.message)}}return(e,s)=>(n(),d(p(X),null,{default:i(()=>[h(p(Y),null,{default:i(()=>[h(p(Q),{class:"flex items-center gap-2"},{default:i(()=>[h(p($e),{class:"w-5 h-5"}),s[3]||(s[3]=I(" Exportar Dados ",-1))]),_:1})]),_:1}),h(p(K),{class:"space-y-6"},{default:i(()=>[h(p(Z),null,{default:i(()=>[h(p(De),{class:"w-4 h-4"}),h(p(ae),null,{default:i(()=>[...s[4]||(s[4]=[I("Informação",-1)])]),_:1}),h(p(ee),null,{default:i(()=>[I(" Exporte todos os "+R(p(a).totalMetadados)+" metadados cadastrados no formato desejado. ",1)]),_:1})]),_:1}),E("div",Ra,[h(p(X),{class:"cursor-pointer transition-all hover:bg-accent",onClick:s[0]||(s[0]=e=>t("csv"))},{default:i(()=>[h(p(K),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:i(()=>[h(p(Se),{class:"w-12 h-12 text-muted-foreground"}),s[5]||(s[5]=E("div",{class:"text-lg font-semibold"},"CSV",-1)),s[6]||(s[6]=E("div",{class:"text-sm text-muted-foreground text-center"},"Valores Separados por Vírgula",-1))]),_:1})]),_:1}),h(p(X),{class:"cursor-pointer transition-all hover:bg-accent",onClick:s[1]||(s[1]=e=>t("excel"))},{default:i(()=>[h(p(K),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:i(()=>[h(p(Se),{class:"w-12 h-12 text-muted-foreground"}),s[7]||(s[7]=E("div",{class:"text-lg font-semibold"},"Excel",-1)),s[8]||(s[8]=E("div",{class:"text-sm text-muted-foreground text-center"},"Planilha XLSX",-1))]),_:1})]),_:1}),h(p(X),{class:"cursor-pointer transition-all hover:bg-accent",onClick:s[2]||(s[2]=e=>t("json"))},{default:i(()=>[h(p(K),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:i(()=>[h(p(Be),{class:"w-12 h-12 text-muted-foreground"}),s[9]||(s[9]=E("div",{class:"text-lg font-semibold"},"JSON",-1)),s[10]||(s[10]=E("div",{class:"text-sm text-muted-foreground text-center"},"JavaScript Object Notation",-1))]),_:1})]),_:1})]),h(p(je)),E("div",Ba,[h(p(De),{class:"w-4 h-4"}),s[11]||(s[11]=I(" O arquivo será baixado automaticamente após a exportação ",-1))])]),_:1})]),_:1}))}},Va={class:"space-y-6"},Pa={class:"flex items-center justify-between"},Ta={__name:"ImportExport",setup:e=>(e,a)=>(n(),A("div",Va,[E("div",Pa,[a[1]||(a[1]=E("h1",{class:"text-3xl font-bold"},"Importar/Exportar",-1)),h(p(T),{variant:"secondary",class:"flex items-center gap-2"},{default:i(()=>[h(p(De),{class:"w-4 h-4"}),a[0]||(a[0]=I(" Gerencie seus dados em diferentes formatos ",-1))]),_:1})]),h(p(G),{"default-value":"importar",class:"w-full"},{default:i(()=>[h(p(H),{class:"grid w-full grid-cols-3"},{default:i(()=>[h(p(J),{value:"importar",class:"flex items-center gap-2"},{default:i(()=>[h(p(te),{class:"w-4 h-4"}),a[2]||(a[2]=I(" Importar Metadados ",-1))]),_:1}),h(p(J),{value:"exportar",class:"flex items-center gap-2"},{default:i(()=>[h(p(Ie),{class:"w-4 h-4"}),a[3]||(a[3]=I(" Exportar Metadados ",-1))]),_:1}),h(p(J),{value:"backup",class:"flex items-center gap-2"},{default:i(()=>[h(p(N),{class:"w-4 h-4"}),a[4]||(a[4]=I(" Backup Completo ",-1))]),_:1})]),_:1}),h(p(z),{value:"importar",class:"space-y-4 mt-6"},{default:i(()=>[a[5]||(a[5]=E("div",null,[E("h2",{class:"text-xl font-semibold mb-1"},"Importar Metadados"),E("p",{class:"text-sm text-muted-foreground"}," Importe registros de metadados de arquivos CSV, Excel ou JSON ")],-1)),h(Aa)]),_:1}),h(p(z),{value:"exportar",class:"space-y-4 mt-6"},{default:i(()=>[a[6]||(a[6]=E("div",null,[E("h2",{class:"text-xl font-semibold mb-1"},"Exportar Apenas Metadados"),E("p",{class:"text-sm text-muted-foreground"}," Exporte somente os registros de metadados em diferentes formatos ")],-1)),h($a)]),_:1}),h(p(z),{value:"backup",class:"space-y-4 mt-6"},{default:i(()=>[a[7]||(a[7]=E("div",null,[E("h2",{class:"text-xl font-semibold mb-1"},"Backup Completo do Sistema"),E("p",{class:"text-sm text-muted-foreground"}," Exporte e importe todos os dados do sistema incluindo configurações e histórico ")],-1)),h(ha)]),_:1})]),_:1})]))};export{Ta as default};
