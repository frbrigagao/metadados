import{aq as o,am as e,m as t,u as a,b as s}from"./index-D9FX90Ms.js";const{similarityExceptions:i}=e(),n=o("exceptions",{state:()=>({exceptions:[],loading:!1}),getters:{totalExceptions:o=>o.exceptions.length,exceptionsByType:o=>o.exceptions.reduce((o,e)=>{const t=e.tipo||"ambos";return o[t]=(o[t]||0)+1,o},{}),exceptionsByMetadado:o=>{const e={};return o.exceptions.forEach(o=>{const t=o.metadado1_id,a=o.metadado2_id;e[t]||(e[t]=[]),e[a]||(e[a]=[]),e[t].push(o),e[a].push(o)}),e}},actions:{async loadExceptions(){this.loading=!0;try{this.exceptions=await i.toArray()}catch(o){throw o}finally{this.loading=!1}},async addException(o,e,t="ambos"){if(!o||!e)throw new Error("IDs de metadados são obrigatórios");if(!["nome","objetivo","ambos"].includes(t))throw new Error("Tipo de exceção inválido. Use: nome, objetivo ou ambos");const[a,s]=o<e?[o,e]:[e,o];if(await this.isException(a,s,t))return null;try{const o={metadado1_id:a,metadado2_id:s,tipo:t,timestamp:Date.now()},e=await i.add(o);return this.exceptions.push({id:e,...o}),e}catch(n){throw n}},async removeException(o){try{await i.delete(o),this.exceptions=this.exceptions.filter(e=>e.id!==o)}catch(e){throw e}},async removeExceptionByPair(o,e,t=null){const[a,s]=o<e?[o,e]:[e,o];try{let o=i.where("metadado1_id").equals(a).and(o=>o.metadado2_id===s);t&&(o=o.and(o=>o.tipo===t));const e=(await o.toArray()).map(o=>o.id);await i.bulkDelete(e),this.exceptions=this.exceptions.filter(o=>!e.includes(o.id))}catch(n){throw n}},async isException(o,e,t="ambos"){const[a,s]=o<e?[o,e]:[e,o];try{const o=await i.where("metadado1_id").equals(a).and(o=>o.metadado2_id===s).toArray();return 0!==o.length&&o.some(o=>"ambos"===o.tipo||("ambos"===t||o.tipo===t))}catch(n){return!1}},getExceptionsForMetadado(o){return this.exceptions.filter(e=>e.metadado1_id===o||e.metadado2_id===o)},async clearAllExceptions(){try{await i.clear(),this.exceptions=[]}catch(o){throw o}},async getException(o){try{return await i.get(o)}catch(e){return null}},async updateExceptionType(o,e){if(!["nome","objetivo","ambos"].includes(e))throw new Error("Tipo de exceção inválido");try{await i.update(o,{tipo:e});const t=this.exceptions.findIndex(e=>e.id===o);-1!==t&&(this.exceptions[t].tipo=e)}catch(t){throw t}}}}),r={responsavel:["encarregado","responsável"],encarregado:["responsavel","responsável"],"responsável":["responsavel","encarregado"],data:["periodo","período"],periodo:["data","período"],"período":["data","periodo"],empresa:["organizacao","organização","companhia"],organizacao:["empresa","organização","companhia"],"organização":["empresa","organizacao","companhia"],companhia:["empresa","organizacao","organização"],cpf:["cadastro de pessoa fisica","cadastro de pessoa física"],"cadastro de pessoa fisica":["cpf","cadastro de pessoa física"],"cadastro de pessoa física":["cpf","cadastro de pessoa fisica"],cnpj:["cadastro nacional de pessoa juridica","cadastro nacional de pessoa jurídica"],"cadastro nacional de pessoa juridica":["cnpj","cadastro nacional de pessoa jurídica"],"cadastro nacional de pessoa jurídica":["cnpj","cadastro nacional de pessoa juridica"],processo:["procedimento","procedência"],procedimento:["processo","procedência"],"procedência":["processo","procedimento"],numero:["número","num","nº"],"número":["numero","num","nº"],num:["numero","número","nº"],"nº":["numero","número","num"],descricao:["descrição"],"descrição":["descricao"],observacao:["observação","obs"],"observação":["observacao","obs"],obs:["observacao","observação"],nome:["denominacao","denominação","titulo","título"],denominacao:["nome","denominação","titulo","título"],"denominação":["nome","denominacao","titulo","título"],titulo:["nome","denominacao","denominação","título"],"título":["nome","denominacao","denominação","titulo"],valor:["quantia","montante"],quantia:["valor","montante"],montante:["valor","quantia"]};function c(o){return o&&"string"==typeof o?o.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim():""}function d(o,e){const t=c(o),a=c(e),s=t.length,i=a.length;if(0===s)return i;if(0===i)return s;const n=[];for(let r=0;r<=s;r++)n[r]=[r];for(let r=0;r<=i;r++)n[0][r]=r;for(let r=1;r<=s;r++)for(let o=1;o<=i;o++){const e=t[r-1]===a[o-1]?0:1;n[r][o]=Math.min(n[r-1][o]+1,n[r][o-1]+1,n[r-1][o-1]+e)}return n[s][i]}function m(o,e){const t=c(o),a=c(e);if(t===a)return 100;if(!t||!a)return 0;const s=d(t,a),i=Math.max(t.length,a.length),n=(i-s)/i*100;return Math.round(100*n)/100}function l(o,e){const t=c(o),a=c(e);if(t===a)return!0;const s=r[t];return!!s&&s.some(o=>c(o)===a)}function p(o){if(!o||"string"!=typeof o)return"";return c(o).split(/\s+/).map(o=>{for(const[e,t]of Object.entries(r))if(o===e||t.some(e=>c(e)===o))return e;return o}).join(" ")}function u(o,e,t=!0){const a=m(o,e),s=t?function(o,e,t=!0){return t?m(p(o),p(e)):m(o,e)}(o,e,!0):a,i=t?function(o,e){const t=c(o).split(/\s+/),a=c(e).split(/\s+/),s=[];for(const i of t)for(const o of a)i!==o&&l(i,o)&&s.push({word1:i,word2:o});return s}(o,e):[];return{score:s,normalScore:a,synonymScore:s,distance:d(o,e),hasSynonyms:i.length>0,synonymPairs:i,normalized1:c(o),normalized2:c(e),canonical1:t?p(o):c(o),canonical2:t?p(e):c(e)}}function h(o,e){const t=o.split(/(\s+)/),a=e.split(/(\s+)/),s=[],i=[],n=Math.max(t.length,a.length);for(let r=0;r<n;r++){const o=t[r]||"",e=a[r]||"",n=c(o)===c(e)&&""!==o&&""!==e&&""!==o.trim();o&&s.push({text:o,similar:n}),e&&i.push({text:e,similar:n})}return{segments1:s,segments2:i,hasSimilarities:s.some(o=>o.similar)||i.some(o=>o.similar)}}function f(o){const e=[];return o.forEach(o=>{Array.isArray(o.tipoDocumento)?o.tipoDocumento.forEach(t=>{e.push({...o,tipoDocumento:t,_originalTipoDocumento:o.tipoDocumento})}):e.push(o)}),e}function v(o){const e=new Set;return o.forEach(o=>{Array.isArray(o.tipoDocumento)?o.tipoDocumento.forEach(o=>e.add(o)):e.add(o.tipoDocumento)}),Array.from(e)}function y(o){return o&&"-"!==o&&""!==o&&""!==o.trim()?o:"Não informado"}function b(){const o=t(),e=a(),i=n(),r=s(()=>{const t={},a=e.synonymsEnabled;o.metadados.forEach(o=>{const e=o.nomeMetadado?.toLowerCase()||"sem nome",a=y(o.classeProcessual),s=`${e}::${a}`;t[s]||(t[s]={nome:o.nomeMetadado,classeProcessual:a,unidades:new Set,items:[],formatos:new Set,objetivos:new Set,metadadosDeProcesso:new Set,admiteMultiplosList:new Set,tiposMetadados:new Set,conflictType:"exato"}),t[s].unidades.add(o.unidade),t[s].items.push(o),o.formatoMetadado&&"NÃO ESPECIFICADO"!==o.formatoMetadado&&t[s].formatos.add(o.formatoMetadado),!o.objetivoNaoInformado&&o.objetivoMetadado&&t[s].objetivos.add(o.objetivoMetadado),t[s].metadadosDeProcesso.add(o.metadadoDeProcesso),t[s].admiteMultiplosList.add(o.admiteMultiplos),o.tipoMetadados&&"NÃO ESPECIFICADO"!==o.tipoMetadados&&t[s].tiposMetadados.add(o.tipoMetadados)});const s=[],n=o.metadados;for(let o=0;o<n.length;o++)for(let e=o+1;e<n.length;e++){const t=n[o],r=n[e],c=y(t.classeProcessual);if(c!==y(r.classeProcessual))continue;if(t.nomeMetadado?.toLowerCase()===r.nomeMetadado?.toLowerCase())continue;if(i.exceptions.some(o=>{const[e,a]=[t.id,r.id].sort((o,e)=>o-e),[s,i]=[o.metadado1_id,o.metadado2_id].sort((o,e)=>o-e);return e===s&&a===i}))continue;let d=u(t.nomeMetadado,r.nomeMetadado,a);const m=(t.nomeMetadado||"").toLowerCase().trim(),l=(r.nomeMetadado||"").toLowerCase().trim();m.length>=4&&l.length>=4&&(m.includes(l)||l.includes(m))&&(d.score=Math.max(d.score,75));const p=new Set(["para","pelo","pela","pelos","pelas","com","sem","sobre","entre","durante","após","antes"]),h=o=>o.toLowerCase().split(/[\s\-_\/]+/).filter(o=>o.length>=5).filter(o=>!p.has(o)).filter(o=>!/^\d+$/.test(o)),f=h(m),v=h(l),b=f.filter(o=>v.includes(o));if(b.length>0&&f.length>0&&v.length>0){const o=Math.max(f.length,v.length),e=60+15*(b.length/o);d.score=Math.max(d.score,e)}const g=!t.objetivoNaoInformado&&t.objetivoMetadado,M=!r.objetivoNaoInformado&&r.objetivoMetadado,w=g&&M?u(t.objetivoMetadado,r.objetivoMetadado,a):{score:0,hasSynonyms:!1},x=d.score>=68,j=w.score>=68&&g&&M;if(x||j){const o=`sim_${t.id}_${r.id}`;s.push({key:o,nome:`${t.nomeMetadado} / ${r.nomeMetadado}`,classeProcessual:c,unidades:[t.unidade,r.unidade],items:[t,r],solicitacoes:2,formatos:new Set([t.formatoMetadado,r.formatoMetadado].filter(o=>o&&"NÃO ESPECIFICADO"!==o)),objetivos:new Set([...t.objetivoMetadado&&!t.objetivoNaoInformado?[t.objetivoMetadado]:[],...r.objetivoMetadado&&!r.objetivoNaoInformado?[r.objetivoMetadado]:[]]),conflictType:x&&j?"ambos":x?"nome":"objetivo",similarityScore:Math.max(d.score,w.score),nomeScore:d.score,objetivoScore:w.score,hasSynonyms:d.hasSynonyms||w.hasSynonyms,nomeComparison:d,objetivoComparison:w,isSimilarity:!0,conflito:!0,metadado1:t,metadado2:r})}}const r={};Object.values(t).forEach(o=>{const e=o.nome?.toLowerCase()||"sem nome";r[e]||(r[e]=[]),r[e].push(o)}),Object.values(r).forEach(o=>{const e=o.some(o=>"Não informado"===o.classeProcessual),t=o.some(o=>"Não informado"!==o.classeProcessual);e&&t&&o.forEach(o=>{o.hasClasseOverlap=!0})});const c=o.metadados.length||1;return[...Object.values(t).map(o=>({nome:o.nome,classeProcessual:o.classeProcessual,unidades:Array.from(o.unidades),solicitacoes:o.items.length,conflito:o.formatos.size>1||o.objetivos.size>1||o.hasClasseOverlap||o.metadadosDeProcesso.size>1||o.admiteMultiplosList.size>1||o.tiposMetadados.size>1,hasFormatoConflict:o.formatos.size>1,hasObjetivoConflict:o.objetivos.size>1,hasClasseOverlap:o.hasClasseOverlap||!1,hasMetadadoProcessoConflict:o.metadadosDeProcesso.size>1,hasAdmiteMultiplosConflict:o.admiteMultiplosList.size>1,hasTipoMetadadosConflict:o.tiposMetadados.size>1,intensidade:o.items.length/c,formatos:o.formatos,objetivos:o.objetivos,items:o.items,conflictType:"exato",isSimilarity:!1})),...s].sort((o,e)=>{const t=o.similarityScore||0,a=e.similarityScore||0,s=o.solicitacoes||o.items?.length||0,i=e.solicitacoes||e.items?.length||0;return t!==a?a-t:i-s})}),c=s(()=>r.value.filter(o=>o.solicitacoes>1)),d=s(()=>r.value.filter(o=>!o.isSimilarity&&o.solicitacoes>1)),m=s(()=>r.value.filter(o=>o.isSimilarity&&o.conflito)),l=s(()=>r.value.filter(o=>1===o.solicitacoes&&!o.hasClasseOverlap&&!o.conflito).map(o=>({nome:o.nome,unidade:o.unidades[0],tiposDocumento:v(o.items),count:o.items.length,items:o.items}))),p=s(()=>({total:o.metadados.length,withOverlap:c.value.length,conflicts:m.value.length,orphans:l.value.length})),h=s(()=>{const e=f(o.metadados),t=[...new Set(e.map(o=>o.tipoDocumento))].sort(),a=[...new Set(e.map(o=>o.unidade))].sort(),s={};return t.forEach(o=>{s[o]={},a.forEach(e=>{s[o][e]=0})}),e.forEach(o=>{s[o.tipoDocumento]&&void 0!==s[o.tipoDocumento][o.unidade]&&s[o.tipoDocumento][o.unidade]++}),{matrix:s,tiposDoc:t,unidades:a}});return{analyzeOverlaps:r,overlaps:c,compartilhamentos:d,conflicts:m,orphans:l,stats:p,matrixData:h,getTiposDocumentoForMetadado:v,expandMetadadosByTipoDocumento:f}}export{n as a,h,b as u};
