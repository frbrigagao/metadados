import{c as ee,U as Ne,d as te,E as Se,B as $e,R as ae,b as W,e as M,f as y,g as s,I as J,J as j,u as e,Q as z,M as Me,P as ie,H as qe,k as t,r as D,au as fe,L as Oe,a0 as Te,ah as Ce,$ as Fe,af as De,W as Le,av as Ue,l as ue,a5 as Ge,ak as Je,j as C,m as i,z as v,y as h,a6 as Y,F as Q,ac as w,p as oe,A as ze,D as He}from"./index-BCE6yiAx.js";import{R as Ke,d as We,a as Ye,b as se,c as re,_ as Qe}from"./TabsTrigger-B2r1nvCz.js";import{e as Xe,_ as B,a as A,b as ne,c as de}from"./CardTitle-CWKSSXXS.js";import{_ as O,a as T}from"./index-D4UCY2q5.js";import{_ as F,U as X}from"./AlertTitle-DdvqMBHC.js";import{e as me,f as ve,g as ge,h as Ze,i as ye,_ as et,a as tt,b as _e,c as at,d as H}from"./TableRow-Db4Azdq9.js";import{V as Re,_ as he}from"./DialogDescription-B1cNPFrZ.js";import{_ as le}from"./Label-CRerd3re.js";import{u as je,i as ot,C as st}from"./useFormControl-BerliXih.js";import{T as rt,_ as lt,r as nt,u as N,w as dt,F as be}from"./xlsx-OYLTnVdd.js";import{_ as Z}from"./Separator-BRm-MatB.js";import{I as G}from"./info-CN8VvO1h.js";import{C as U,_ as it,a as K}from"./TableHeader-Bj77q6Xe.js";/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=ee("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]);/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ut=ee("file-input",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 15h10",key:"jfw4w8"}],["path",{d:"m9 18 3-3-3-3",key:"112psh"}]]);/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ct=ee("file-json",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=ee("file-output",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4 7V4a2 2 0 0 1 2-2 2 2 0 0 0-2 2",key:"1vk7w2"}],["path",{d:"M4.063 20.999a2 2 0 0 0 2 1L18 22a2 2 0 0 0 2-2V7l-5-5H6",key:"1jink5"}],["path",{d:"m5 11-3 3",key:"1dgrs4"}],["path",{d:"m5 17-3-3h10",key:"1mvvaf"}]]),ft="radio.select";function mt(r,n,a){Ne(ft,a,{originalEvent:r,value:n})}var vt=te({__name:"Radio",props:{id:{type:String,required:!1},value:{type:null,required:!1},disabled:{type:Boolean,required:!1,default:!1},checked:{type:Boolean,required:!1,default:void 0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["update:checked","select"],setup(r,{emit:n}){const a=r,d=n,o=Se(a,"checked",d,{passive:a.checked===void 0}),{value:c}=$e(a),{forwardRef:f,currentElement:_}=ae(),p=je(_),x=W(()=>a.id&&_.value?document.querySelector(`[for="${a.id}"]`)?.innerText??a.value:void 0);function g(u){a.disabled||mt(u,a.value,m=>{d("select",m),!m?.defaultPrevented&&(o.value=!0,p.value&&m.stopPropagation())})}return(u,m)=>(y(),M(e(ie),z(u.$attrs,{id:u.id,ref:e(f),role:"radio",type:u.as==="button"?"button":void 0,as:u.as,"aria-checked":e(o),"aria-label":x.value,"as-child":u.asChild,disabled:u.disabled?"":void 0,"data-state":e(o)?"checked":"unchecked","data-disabled":u.disabled?"":void 0,value:e(c),required:u.required,name:u.name,onClick:Me(g,["stop"])}),{default:s(()=>[J(u.$slots,"default",{checked:e(o)}),e(p)&&u.name?(y(),M(e(Re),{key:0,type:"radio",tabindex:"-1",value:e(c),checked:!!e(o),name:u.name,disabled:u.disabled,required:u.required},null,8,["value","checked","name","disabled","required"])):j("v-if",!0)]),_:3},16,["id","type","as","aria-checked","aria-label","as-child","disabled","data-state","data-disabled","value","required","name"]))}}),gt=vt;const[yt,_t]=qe("RadioGroupRoot");var ht=te({__name:"RadioGroupRoot",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},disabled:{type:Boolean,required:!1,default:!1},orientation:{type:String,required:!1,default:void 0},dir:{type:String,required:!1},loop:{type:Boolean,required:!1,default:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1,default:!1}},emits:["update:modelValue"],setup(r,{emit:n}){const a=r,d=n,{forwardRef:o,currentElement:c}=ae(),f=Se(a,"modelValue",d,{defaultValue:a.defaultValue,passive:a.modelValue===void 0}),{disabled:_,loop:p,orientation:x,name:g,required:u,dir:m}=$e(a),b=Xe(m),k=je(c);return _t({modelValue:f,changeModelValue:q=>{f.value=q},disabled:_,loop:p,orientation:x,name:g?.value,required:u}),(q,I)=>(y(),M(e(Ke),{"as-child":"",orientation:e(x),dir:e(b),loop:e(p)},{default:s(()=>[t(e(ie),{ref:e(o),role:"radiogroup","data-disabled":e(_)?"":void 0,"as-child":q.asChild,as:q.as,"aria-orientation":e(x),"aria-required":e(u),dir:e(b)},{default:s(()=>[J(q.$slots,"default",{modelValue:e(f)}),e(k)&&e(g)?(y(),M(e(Re),{key:0,required:e(u),disabled:e(_),value:e(f),name:e(g)},null,8,["required","disabled","value","name"])):j("v-if",!0)]),_:3},8,["data-disabled","as-child","as","aria-orientation","aria-required","dir"])]),_:3},8,["orientation","dir","loop"]))}}),bt=ht;const[xt,wt]=qe("RadioGroupItem");var kt=te({inheritAttrs:!1,__name:"RadioGroupItem",props:{id:{type:String,required:!1},value:{type:null,required:!1},disabled:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["select"],setup(r,{emit:n}){const a=r,d=n,{forwardRef:o,currentElement:c}=ae(),f=yt(),_=W(()=>f.disabled.value||a.disabled),p=W(()=>f.required.value||a.required),x=W(()=>ot(f.modelValue?.value,a.value));wt({disabled:_,checked:x});const g=D(!1),u=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];fe("keydown",b=>{u.includes(b.key)&&(g.value=!0)}),fe("keyup",()=>{g.value=!1});function m(){setTimeout(()=>{g.value&&c.value?.click()},0)}return(b,k)=>(y(),M(e(We),{checked:x.value,disabled:_.value,"as-child":"",focusable:!_.value,active:x.value},{default:s(()=>[t(gt,z({...b.$attrs,...a},{ref:e(o),checked:x.value,required:p.value,disabled:_.value,"onUpdate:checked":k[0]||(k[0]=q=>e(f).changeModelValue(b.value)),onSelect:k[1]||(k[1]=q=>d("select",q)),onKeydown:k[2]||(k[2]=Oe(Me(()=>{},["prevent"]),["enter"])),onFocus:m}),{default:s(()=>[J(b.$slots,"default",{checked:x.value,required:p.value,disabled:_.value})]),_:3},16,["checked","required","disabled"])]),_:3},8,["checked","disabled","focusable","active"]))}}),St=kt,$t=te({__name:"RadioGroupIndicator",props:{forceMount:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(r){const{forwardRef:n}=ae(),a=xt();return(d,o)=>(y(),M(e(Te),{present:d.forceMount||e(a).checked.value},{default:s(()=>[t(e(ie),z({ref:e(n),"data-state":e(a).checked.value?"checked":"unchecked","data-disabled":e(a).disabled.value?"":void 0,"as-child":d.asChild,as:d.as},d.$attrs),{default:s(()=>[J(d.$slots,"default")]),_:3},16,["data-state","data-disabled","as-child","as"])]),_:3},8,["present"]))}}),Mt=$t;const qt={__name:"RadioGroup",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},disabled:{type:Boolean,required:!1},orientation:{type:String,required:!1},dir:{type:String,required:!1},loop:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1},class:{type:null,required:!1}},emits:["update:modelValue"],setup(r,{emit:n}){const a=r,d=n,o=Ce(a,"class"),c=Fe(o,d);return(f,_)=>(y(),M(e(bt),z({class:e(De)("grid gap-2",a.class)},e(c)),{default:s(()=>[J(f.$slots,"default")]),_:3},16,["class"]))}},xe={__name:"RadioGroupItem",props:{id:{type:String,required:!1},value:{type:null,required:!1},disabled:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1},class:{type:null,required:!1}},setup(r){const n=r,a=Ce(n,"class"),d=Le(a);return(o,c)=>(y(),M(e(St),z(e(d),{class:e(De)("peer aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",n.class)}),{default:s(()=>[t(e(Mt),{class:"flex items-center justify-center"},{default:s(()=>[t(e(st),{class:"h-3.5 w-3.5 text-primary"})]),_:1})]),_:1},16,["class"]))}};function Ct(r){try{return!r||typeof r!="object"?{valid:!1,error:"Arquivo inválido"}:r.version?!r.data||typeof r.data!="object"?{valid:!1,error:"Dados do backup não encontrados"}:["metadados","config","history","tags"].some(d=>r.data[d]&&Array.isArray(r.data[d]))?{valid:!0}:{valid:!1,error:"Nenhuma tabela válida encontrada no backup"}:{valid:!1,error:"Versão do backup não encontrada"}}catch(n){return{valid:!1,error:"Erro ao validar backup: "+n.message}}}function Dt(){const r=new Date,n=r.getFullYear(),a=String(r.getMonth()+1).padStart(2,"0"),d=String(r.getDate()).padStart(2,"0"),o=String(r.getHours()).padStart(2,"0"),c=String(r.getMinutes()).padStart(2,"0"),f=String(r.getSeconds()).padStart(2,"0");return`backup-metadados-${n}-${a}-${d}-${o}${c}${f}.json`}function Rt(r){if(!r||!r.data)return null;const n={version:r.version||"Desconhecida",exportDate:r.exportDate?new Date(r.exportDate):null,appVersion:r.appVersion||"Desconhecida",totalRecords:{metadados:r.data.metadados?.length||0,config:r.data.config?.length||0,classesProcessuais:r.data.classesProcessuais?.length||0,tiposDocumentosImportados:r.data.tiposDocumentosImportados?.length||0,history:r.data.history?.length||0,tags:r.data.tags?.length||0}};return n.total=Object.values(n.totalRecords).reduce((a,d)=>a+d,0),n}function jt(r){if(r===0)return"0 Bytes";const n=1024,a=["Bytes","KB","MB","GB"],d=Math.floor(Math.log(r)/Math.log(n));return Math.round(r/Math.pow(n,d)*100)/100+" "+a[d]}function It(r){if(!r)return"Data desconhecida";const n=new Date(r),a=String(n.getDate()).padStart(2,"0"),d=String(n.getMonth()+1).padStart(2,"0"),o=n.getFullYear(),c=String(n.getHours()).padStart(2,"0"),f=String(n.getMinutes()).padStart(2,"0");return`${a}/${d}/${o} às ${c}:${f}`}const Et={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Bt={class:"flex items-center gap-2 text-sm text-muted-foreground"},At={key:0,class:"space-y-4 py-4"},Vt={class:"rounded-lg border p-4 space-y-2"},Pt={class:"grid grid-cols-2 gap-2 text-sm"},Nt={class:"font-semibold"},Ot={class:"text-sm space-y-1"},Tt={class:"flex justify-between"},Ft={class:"font-medium"},Lt={class:"flex justify-between"},Ut={class:"font-medium"},Gt={class:"flex justify-between"},Jt={class:"font-medium"},zt={class:"flex justify-between"},Ht={class:"font-medium"},Kt={class:"flex justify-between"},Wt={class:"font-medium"},Yt={class:"flex justify-between"},Qt={class:"font-medium"},Xt={class:"space-y-3"},Zt={class:"flex-1"},ea={class:"flex-1"},ta={class:"space-y-4 py-4"},aa={class:"text-center text-sm text-muted-foreground"},oa={__name:"BackupCard",setup(r){const{exportAll:n,importAll:a,clearAll:d}=Ue(),o=ue(),c=Ge(),f=Je(),_=D(null),p=D(!1),x=D(!1),g=D(!1),u=D("merge"),m=D(null),b=D(null),k=D({current:0,total:0});async function q(){try{w.info("Preparando backup...");const S=await n(),l={version:"1.0",exportDate:new Date().toISOString(),appVersion:"4.0",totalRecords:{metadados:S.metadados.length,config:S.config.length,classesProcessuais:S.classesProcessuais.length,tiposDocumentosImportados:S.tiposDocumentosImportados.length,history:S.history.length,tags:S.tags.length},data:S},$=JSON.stringify(l,null,2),E=new Blob([$],{type:"application/json"}),V=jt(E.size),P=URL.createObjectURL(E),L=document.createElement("a");L.href=P,L.download=Dt(),L.click(),URL.revokeObjectURL(P);const Ae=Object.values(l.totalRecords).reduce((Ve,Pe)=>Ve+Pe,0);w.success(`Backup exportado com sucesso! ${Ae} registros (${V})`)}catch(S){console.error("Erro ao exportar backup:",S),w.error("Erro ao exportar backup: "+S.message)}}function I(){_.value?.click()}async function Ee(S){const l=S.target.files?.[0];if(l)try{g.value=!0,w.info("Lendo arquivo de backup...");const $=await l.text(),E=JSON.parse($),V=Ct(E);if(!V.valid){w.error(V.error);return}m.value=Rt(E),b.value=E,u.value="merge",p.value=!0,_.value&&(_.value.value="")}catch($){console.error("Erro ao ler backup:",$),w.error("Erro ao ler arquivo: "+$.message)}finally{g.value=!1}}function Be(){p.value=!1,m.value=null,b.value=null,u.value="merge"}async function pe(){if(b.value)try{g.value=!0,p.value=!1,x.value=!0;const S=m.value.total;k.value={current:0,total:S},u.value==="replace"&&(w.info("Criando backup de segurança..."),await q(),w.info("Limpando banco de dados..."),await d()),w.info("Importando dados...");const l=b.value.data,$=["metadados","config","classesProcessuais","tiposDocumentosImportados","history","tags"];let E=0;for(const P of $)l[P]&&l[P].length>0&&(k.value.current=E,await new Promise(L=>setTimeout(L,200))),E+=l[P]?.length||0;await a(l),k.value.current=S,w.info("Atualizando interface..."),await Promise.all([c.loadConfig(),c.loadClassesProcessuais(),c.loadTiposDocumentosImportados(),o.loadMetadados(),f.loadHistory()]),x.value=!1;const V=u.value==="replace"?"substituídos":"mesclados";w.success(`Backup importado com sucesso! ${S} registros ${V}`),m.value=null,b.value=null,u.value="merge"}catch(S){console.error("Erro ao importar backup:",S),x.value=!1,w.error("Erro ao importar backup: "+S.message)}finally{g.value=!1}}return(S,l)=>(y(),C(Q,null,[t(e(A),null,{default:s(()=>[t(e(B),{class:"space-y-6 pt-6"},{default:s(()=>[t(e(O),null,{default:s(()=>[t(e(G),{class:"w-4 h-4"}),t(e(F),null,{default:s(()=>[...l[5]||(l[5]=[v("O backup completo inclui",-1)])]),_:1}),t(e(T),null,{default:s(()=>[...l[6]||(l[6]=[i("ul",{class:"list-disc pl-4 space-y-1 mt-2"},[i("li",null,"Todos os metadados cadastrados"),i("li",null,"Configurações (unidades, tipos de documento, formatos)"),i("li",null,"Classes processuais (se carregadas)"),i("li",null,"Tipos de documentos importados (se importados)"),i("li",null,"Histórico completo de alterações"),i("li",null,"Tags (se existirem)")],-1)])]),_:1})]),_:1}),i("div",Et,[t(e(A),{class:"cursor-pointer transition-all hover:bg-accent",onClick:q},{default:s(()=>[t(e(B),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:s(()=>[t(e(Ie),{class:"w-12 h-12 text-muted-foreground"}),l[7]||(l[7]=i("div",{class:"text-lg font-semibold"},"Exportar Backup",-1)),l[8]||(l[8]=i("div",{class:"text-sm text-muted-foreground text-center"}," Salvar cópia completa do banco de dados ",-1))]),_:1})]),_:1}),t(e(A),{class:"cursor-pointer transition-all hover:bg-accent",onClick:I},{default:s(()=>[t(e(B),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:s(()=>[t(e(X),{class:"w-12 h-12 text-muted-foreground"}),l[9]||(l[9]=i("div",{class:"text-lg font-semibold"},"Importar Backup",-1)),l[10]||(l[10]=i("div",{class:"text-sm text-muted-foreground text-center"}," Restaurar dados de um backup anterior ",-1))]),_:1})]),_:1})]),i("input",{ref_key:"fileInputRef",ref:_,type:"file",accept:".json",class:"hidden",onChange:Ee},null,544),t(e(Z)),i("div",Bt,[t(e(U),{class:"w-4 h-4"}),l[11]||(l[11]=v(" Formato: JSON com todas as tabelas do banco de dados ",-1))])]),_:1})]),_:1}),t(e(ye),{open:p.value,"onUpdate:open":l[3]||(l[3]=$=>p.value=$)},{default:s(()=>[t(e(me),{class:"max-w-2xl"},{default:s(()=>[t(e(ve),null,{default:s(()=>[t(e(ge),null,{default:s(()=>[...l[12]||(l[12]=[v("Importar Backup Completo",-1)])]),_:1}),t(e(he),null,{default:s(()=>[...l[13]||(l[13]=[v(" Escolha como deseja importar os dados do backup ",-1)])]),_:1})]),_:1}),m.value?(y(),C("div",At,[i("div",Vt,[l[23]||(l[23]=i("div",{class:"font-semibold"},"Informações do Backup",-1)),i("div",Pt,[l[14]||(l[14]=i("div",{class:"text-muted-foreground"},"Data do backup:",-1)),i("div",null,h(e(It)(m.value.exportDate)),1),l[15]||(l[15]=i("div",{class:"text-muted-foreground"},"Versão:",-1)),i("div",null,h(m.value.version),1),l[16]||(l[16]=i("div",{class:"text-muted-foreground"},"Total de registros:",-1)),i("div",Nt,h(m.value.total),1)]),t(e(Z),{class:"my-3"}),i("div",Ot,[i("div",Tt,[l[17]||(l[17]=i("span",{class:"text-muted-foreground"},"Metadados:",-1)),i("span",Ft,h(m.value.totalRecords.metadados),1)]),i("div",Lt,[l[18]||(l[18]=i("span",{class:"text-muted-foreground"},"Configurações:",-1)),i("span",Ut,h(m.value.totalRecords.config),1)]),i("div",Gt,[l[19]||(l[19]=i("span",{class:"text-muted-foreground"},"Classes Processuais:",-1)),i("span",Jt,h(m.value.totalRecords.classesProcessuais),1)]),i("div",zt,[l[20]||(l[20]=i("span",{class:"text-muted-foreground"},"Tipos de Documentos Importados:",-1)),i("span",Ht,h(m.value.totalRecords.tiposDocumentosImportados),1)]),i("div",Kt,[l[21]||(l[21]=i("span",{class:"text-muted-foreground"},"Histórico:",-1)),i("span",Wt,h(m.value.totalRecords.history),1)]),i("div",Yt,[l[22]||(l[22]=i("span",{class:"text-muted-foreground"},"Tags:",-1)),i("span",Qt,h(m.value.totalRecords.tags),1)])])]),i("div",Xt,[t(e(le),null,{default:s(()=>[...l[24]||(l[24]=[v("Modo de Importação",-1)])]),_:1}),t(e(qt),{modelValue:u.value,"onUpdate:modelValue":l[2]||(l[2]=$=>u.value=$)},{default:s(()=>[i("div",{class:"flex items-start space-x-3 rounded-lg border p-4 cursor-pointer hover:bg-accent",onClick:l[0]||(l[0]=$=>u.value="merge")},[t(e(xe),{value:"merge",id:"merge"}),i("div",Zt,[t(e(le),{for:"merge",class:"cursor-pointer font-semibold"},{default:s(()=>[...l[25]||(l[25]=[v(" Mesclar Dados ",-1)])]),_:1}),l[26]||(l[26]=i("p",{class:"text-sm text-muted-foreground mt-1"}," Adiciona novos registros e atualiza os existentes. Nenhum dado será removido. ",-1))])]),i("div",{class:"flex items-start space-x-3 rounded-lg border p-4 cursor-pointer hover:bg-accent",onClick:l[1]||(l[1]=$=>u.value="replace")},[t(e(xe),{value:"replace",id:"replace"}),i("div",ea,[t(e(le),{for:"replace",class:"cursor-pointer font-semibold text-destructive"},{default:s(()=>[...l[27]||(l[27]=[v(" Substituir Tudo ",-1)])]),_:1}),l[28]||(l[28]=i("p",{class:"text-sm text-muted-foreground mt-1"}," Remove todos os dados atuais e substitui pelos dados do backup. Esta ação é irreversível! ",-1))])])]),_:1},8,["modelValue"])]),u.value==="replace"?(y(),M(e(O),{key:0,variant:"destructive"},{default:s(()=>[t(e(U),{class:"w-4 h-4"}),t(e(F),null,{default:s(()=>[...l[29]||(l[29]=[v("ATENÇÃO: Ação Irreversível!",-1)])]),_:1}),t(e(T),null,{default:s(()=>[...l[30]||(l[30]=[v(" Todos os dados atuais serão permanentemente apagados, incluindo metadados, configurações e histórico. Recomendamos fazer um backup antes de prosseguir. ",-1)])]),_:1})]),_:1})):j("",!0)])):j("",!0),t(e(Ze),null,{default:s(()=>[t(e(Y),{variant:"outline",onClick:Be},{default:s(()=>[...l[31]||(l[31]=[v(" Cancelar ",-1)])]),_:1}),u.value==="merge"?(y(),M(e(Y),{key:0,onClick:pe,disabled:g.value},{default:s(()=>[t(e(X),{class:"w-4 h-4 mr-2"}),l[32]||(l[32]=v(" Confirmar Mesclagem ",-1))]),_:1},8,["disabled"])):(y(),M(e(Y),{key:1,variant:"destructive",onClick:pe,disabled:g.value},{default:s(()=>[t(e(rt),{class:"w-4 h-4 mr-2"}),l[33]||(l[33]=v(" Sim, Substituir Tudo ",-1))]),_:1},8,["disabled"]))]),_:1})]),_:1})]),_:1},8,["open"]),t(e(ye),{open:x.value,"onUpdate:open":l[4]||(l[4]=$=>x.value=$),closable:!1},{default:s(()=>[t(e(me),{class:"max-w-md"},{default:s(()=>[t(e(ve),null,{default:s(()=>[t(e(ge),null,{default:s(()=>[...l[34]||(l[34]=[v("Importando Backup",-1)])]),_:1}),t(e(he),null,{default:s(()=>[...l[35]||(l[35]=[v(" Por favor, aguarde enquanto os dados são importados... ",-1)])]),_:1})]),_:1}),i("div",ta,[l[36]||(l[36]=i("div",{class:"flex items-center justify-center"},[i("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"})],-1)),i("div",aa," Importando "+h(k.value.current)+" de "+h(k.value.total)+" registros... ",1),t(e(lt),{value:k.value.current/k.value.total*100},null,8,["value"])])]),_:1})]),_:1},8,["open"])],64))}};function sa(r){const n=r.split(`
`).filter(o=>o.trim());if(n.length<2)throw new Error("Arquivo CSV vazio ou inválido");const a=we(n[0]),d=[];for(let o=1;o<n.length;o++){const c=we(n[o]);if(c.length===0)continue;const f={};a.forEach((_,p)=>{f[_]=c[p]||""}),d.push(f)}return ce(d)}function we(r){const n=[];let a="",d=!1;for(let o=0;o<r.length;o++){const c=r[o];c==='"'?d&&r[o+1]==='"'?(a+='"',o++):d=!d:c===","&&!d?(n.push(a.trim()),a=""):a+=c}return n.push(a.trim()),n}function ra(r){const n=nt(r,{type:"array"}),a=n.Sheets[n.SheetNames[0]],d=N.sheet_to_json(a);if(d.length===0)throw new Error("Planilha vazia ou inválida");return ce(d)}function la(r){try{const n=JSON.parse(r);if(!Array.isArray(n))throw new Error("JSON deve ser um array de objetos");return ce(n)}catch(n){throw new Error("JSON inválido: "+n.message)}}function ce(r){return r.map(n=>{const a={};Object.keys(n).forEach(o=>{const c=o.toLowerCase().trim();c!=="id"&&(a[c]=n[o])});const d={unidade:R(a,["unidade"]),metadadoDeProcesso:ke(R(a,["metadado de processo","metadadodeprocesso"])),classeProcessual:R(a,["classe processual","classeprocessual","classe"])||"Não informado",tipoDocumento:na(R(a,["tipo de documento","tipodocumento","tipo documento"])),nomeMetadado:R(a,["nome do metadado","nome","metadado","nomemetadado"]),objetivoMetadado:R(a,["objetivo","objetivo do metadado","objetivometadado"]),formatoMetadado:R(a,["formato","formato do metadado","formatometadado"]),admiteMultiplos:ke(R(a,["admite múltiplos","admite multiplos","admitemultiplos"])),tipoMetadados:R(a,["tipo de metadados","tipo metadados","tipometadados"]),versaoInicialAtende:R(a,["versão inicial atende","versao inicial atende","versaoinicialatende"]),observacao:R(a,["observação","observacao","obs"])};return Object.keys(d).forEach(o=>{o!=="classeProcessual"&&(d[o]===""||d[o]===null||d[o]===void 0)&&delete d[o]}),delete d.id,d})}function R(r,n){for(const a of n)if(r[a]!==void 0&&r[a]!==null)return r[a].toString().trim();return""}function ke(r){if(typeof r=="boolean")return r;if(typeof r=="string"){const n=r.toLowerCase().trim();return n==="sim"||n==="yes"||n==="true"||n==="1"}return!1}function na(r){if(!r)return[];if(Array.isArray(r))return r.map(d=>d==null?"":String(d).trim()).filter(d=>d.length>0);const n=r.toString();let a=";";return n.includes(";")?a=";":n.includes(",")&&(a=","),n.split(a).map(d=>d.trim()).filter(d=>d.length>0)}function da(r){const n=[],a=[];return r.forEach((d,o)=>{const c=o+2;d.unidade||n.push(`Linha ${c}: Campo "Unidade" é obrigatório`),d.nomeMetadado||n.push(`Linha ${c}: Campo "Nome do Metadado" é obrigatório`),d.tipoMetadados||n.push(`Linha ${c}: Campo "Tipo de Metadados" é obrigatório`),(!d.tipoDocumento||d.tipoDocumento.length===0)&&n.push(`Linha ${c}: Campo "Tipo de Documento" é obrigatório`),d.objetivoMetadado||a.push(`Linha ${c}: Campo "Objetivo" não preenchido`)}),{errors:n,warnings:a}}const ia={class:"flex items-center gap-2"},ua={key:0},ca={class:"border rounded-md max-h-[300px] overflow-auto"},pa={key:0},fa={key:1},ma={key:0,class:"text-sm text-muted-foreground mt-2"},va={key:1,class:"space-y-2"},ga={class:"list-disc pl-4 space-y-1"},ya={key:0,class:"text-xs mt-2"},_a={class:"list-disc pl-4 space-y-1"},ha={key:0,class:"text-xs mt-2"},ba={class:"flex items-center gap-2 text-sm text-muted-foreground"},xa={__name:"ImportCard",setup(r){const n=ue(),a=D(null),d=D(null),o=D([]),c=D(null),f=D(!1);async function _(g){const u=g.target.files?.[0];if(u){d.value=u,o.value=[],c.value=null;try{f.value=!0;const m=await p(u);o.value=m,c.value=da(m)}catch(m){w.error("Erro ao ler arquivo: "+m.message)}finally{f.value=!1}}}async function p(g){const u=g.name.split(".").pop().toLowerCase();return new Promise((m,b)=>{const k=new FileReader;k.onload=async q=>{try{let I;if(u==="csv")I=sa(q.target.result);else if(u==="xlsx"||u==="xls")I=ra(q.target.result);else if(u==="json")I=la(q.target.result);else{b(new Error("Formato de arquivo não suportado"));return}m(I)}catch(I){b(I)}},k.onerror=()=>b(new Error("Erro ao ler arquivo")),u==="xlsx"||u==="xls"?k.readAsArrayBuffer(g):k.readAsText(g)})}async function x(){if(!o.value.length){w.error("Nenhum dado para importar");return}if(c.value?.errors.length>0){w.error("Corrija os erros antes de importar");return}try{f.value=!0;for(const g of o.value)await n.addMetadado(g);w.success(`${o.value.length} registros importados com sucesso!`),a.value&&(a.value.value=""),d.value=null,o.value=[],c.value=null}catch(g){w.error("Erro ao importar: "+g.message)}finally{f.value=!1}}return(g,u)=>(y(),M(e(A),null,{default:s(()=>[t(e(ne),null,{default:s(()=>[t(e(de),{class:"flex items-center gap-2"},{default:s(()=>[t(e(ut),{class:"w-5 h-5"}),u[0]||(u[0]=v(" Importar Dados ",-1))]),_:1})]),_:1}),t(e(B),{class:"space-y-4"},{default:s(()=>[t(e(O),{variant:"warning"},{default:s(()=>[t(e(U),{class:"w-4 h-4"}),t(e(F),null,{default:s(()=>[...u[1]||(u[1]=[v("Atenção",-1)])]),_:1}),t(e(T),null,{default:s(()=>[...u[2]||(u[2]=[v(" A importação irá adicionar os novos registros aos existentes. Para substituir todos os dados, limpe o banco antes. ",-1)])]),_:1})]),_:1}),i("div",ia,[t(e(et),{ref_key:"fileInputRef",ref:a,type:"file",accept:".csv,.xlsx,.xls,.json",disabled:f.value,onChange:_,class:"flex-1"},null,8,["disabled"]),t(e(Y),{disabled:!d.value||f.value,onClick:x},{default:s(()=>[t(e(X),{class:"w-4 h-4 mr-2"}),u[3]||(u[3]=v(" Importar ",-1))]),_:1},8,["disabled"])]),o.value.length>0?(y(),C("div",ua,[t(e(A),null,{default:s(()=>[t(e(ne),null,{default:s(()=>[t(e(de),{class:"text-lg"},{default:s(()=>[v(" Pré-visualização ("+h(o.value.length)+" registros) ",1)]),_:1})]),_:1}),t(e(B),null,{default:s(()=>[i("div",ca,[t(e(tt),null,{default:s(()=>[t(e(it),null,{default:s(()=>[t(e(_e),null,{default:s(()=>[t(e(K),null,{default:s(()=>[...u[4]||(u[4]=[v("Unidade",-1)])]),_:1}),t(e(K),null,{default:s(()=>[...u[5]||(u[5]=[v("Tipo Documento",-1)])]),_:1}),t(e(K),null,{default:s(()=>[...u[6]||(u[6]=[v("Nome Metadado",-1)])]),_:1}),t(e(K),null,{default:s(()=>[...u[7]||(u[7]=[v("Tipo",-1)])]),_:1})]),_:1})]),_:1}),t(e(at),null,{default:s(()=>[(y(!0),C(Q,null,oe(o.value.slice(0,10),(m,b)=>(y(),M(e(_e),{key:b},{default:s(()=>[t(e(H),null,{default:s(()=>[v(h(m.unidade),1)]),_:2},1024),t(e(H),null,{default:s(()=>[Array.isArray(m.tipoDocumento)?(y(),C("span",pa,h(m.tipoDocumento.join(", ")),1)):(y(),C("span",fa,h(m.tipoDocumento),1))]),_:2},1024),t(e(H),null,{default:s(()=>[v(h(m.nomeMetadado),1)]),_:2},1024),t(e(H),null,{default:s(()=>[v(h(m.tipoMetadados),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),o.value.length>10?(y(),C("p",ma," Mostrando 10 de "+h(o.value.length)+" registros ",1)):j("",!0)]),_:1})]),_:1})])):j("",!0),c.value?(y(),C("div",va,[c.value.errors.length>0?(y(),M(e(O),{key:0,variant:"destructive"},{default:s(()=>[t(e(U),{class:"w-4 h-4"}),t(e(F),null,{default:s(()=>[v(h(c.value.errors.length)+" "+h(c.value.errors.length===1?"erro encontrado":"erros encontrados"),1)]),_:1}),t(e(T),null,{default:s(()=>[i("ul",ga,[(y(!0),C(Q,null,oe(c.value.errors.slice(0,5),(m,b)=>(y(),C("li",{key:b},h(m),1))),128))]),c.value.errors.length>5?(y(),C("p",ya," ... e mais "+h(c.value.errors.length-5)+" erros ",1)):j("",!0)]),_:1})]),_:1})):j("",!0),c.value.warnings.length>0?(y(),M(e(O),{key:1,variant:"warning"},{default:s(()=>[t(e(U),{class:"w-4 h-4"}),t(e(F),null,{default:s(()=>[v(h(c.value.warnings.length)+" "+h(c.value.warnings.length===1?"aviso":"avisos"),1)]),_:1}),t(e(T),null,{default:s(()=>[i("ul",_a,[(y(!0),C(Q,null,oe(c.value.warnings.slice(0,3),(m,b)=>(y(),C("li",{key:b},h(m),1))),128))]),c.value.warnings.length>3?(y(),C("p",ha," ... e mais "+h(c.value.warnings.length-3)+" avisos ",1)):j("",!0)]),_:1})]),_:1})):j("",!0)])):j("",!0),t(e(Z)),i("div",ba,[t(e(G),{class:"w-4 h-4"}),u[8]||(u[8]=v(" Formatos suportados: CSV, Excel (.xlsx, .xls), JSON ",-1))])]),_:1})]),_:1}))}};function wa(r){const n=["Unidade","Metadado de Processo","Classe Processual","Tipo de Documento","Nome do Metadado","Objetivo","Formato","Admite Múltiplos","Tipo de Metadados","Versão Inicial Atende","Observação"],a=r.map(f=>[f.unidade||"",f.metadadoDeProcesso?"Sim":"Não",f.classeProcessual||"Não informado",Array.isArray(f.tipoDocumento)?f.tipoDocumento.join(";"):f.tipoDocumento||"",f.nomeMetadado||"",f.objetivoMetadado||"",f.formatoMetadado||"",f.admiteMultiplos?"Sim":"Não",f.tipoMetadados||"",f.versaoInicialAtende||"",f.observacao||""]);let d=n.join(",")+`
`;a.forEach(f=>{d+=f.map(_=>`"${_.toString().replace(/"/g,'""')}"`).join(",")+`
`});const o=new Blob([d],{type:"text/csv;charset=utf-8;"}),c=document.createElement("a");c.href=URL.createObjectURL(o),c.download=`metadados_${new Date().toISOString().split("T")[0]}.csv`,c.click()}function ka(r){const n=r.map(p=>({Unidade:p.unidade||"","Metadado de Processo":p.metadadoDeProcesso?"Sim":"Não","Classe Processual":p.classeProcessual||"Não informado","Tipo de Documento":Array.isArray(p.tipoDocumento)?p.tipoDocumento.join(";"):p.tipoDocumento||"","Nome do Metadado":p.nomeMetadado||"",Objetivo:p.objetivoMetadado||"",Formato:p.formatoMetadado||"","Admite Múltiplos":p.admiteMultiplos?"Sim":"Não","Tipo de Metadados":p.tipoMetadados||"","Versão Inicial Atende":p.versaoInicialAtende||"",Observação:p.observacao||""})),a=N.json_to_sheet(n),d=[{wch:15},{wch:20},{wch:35},{wch:30},{wch:30},{wch:40},{wch:20},{wch:18},{wch:18},{wch:22},{wch:40}];a["!cols"]=d;const o=[];r.forEach(p=>{(Array.isArray(p.tipoDocumento)?p.tipoDocumento:p.tipoDocumento?[p.tipoDocumento]:["Não especificado"]).forEach(g=>{o.push({"Tipo de Documento":g,"Nome do Metadado":p.nomeMetadado||"",Unidade:p.unidade||"",Objetivo:p.objetivoMetadado||"",Formato:p.formatoMetadado||"","Admite Múltiplos":p.admiteMultiplos?"Sim":"Não","Tipo de Metadados":p.tipoMetadados||"","Metadado de Processo":p.metadadoDeProcesso?"Sim":"Não","Versão Inicial Atende":p.versaoInicialAtende||"",Observação:p.observacao||"","Classe Processual":p.classeProcessual||"Não informado"})})}),o.sort((p,x)=>{const g=p["Tipo de Documento"].localeCompare(x["Tipo de Documento"]);return g!==0?g:p["Nome do Metadado"].localeCompare(x["Nome do Metadado"])});const c=N.json_to_sheet(o),f=[{wch:35},{wch:30},{wch:15},{wch:40},{wch:20},{wch:18},{wch:18},{wch:20},{wch:22},{wch:40},{wch:35}];c["!cols"]=f;const _=N.book_new();N.book_append_sheet(_,a,"Metadados"),N.book_append_sheet(_,c,"Por Tipo de Documento"),dt(_,`metadados_${new Date().toISOString().split("T")[0]}.xlsx`)}function Sa(r){const n=JSON.stringify(r,null,2),a=new Blob([n],{type:"application/json"}),d=document.createElement("a");d.href=URL.createObjectURL(a),d.download=`metadados_${new Date().toISOString().split("T")[0]}.json`,d.click()}const $a={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ma={class:"flex items-center gap-2 text-sm text-muted-foreground"},qa={__name:"ExportCard",setup(r){const n=ue();async function a(d){try{const o=n.metadados;if(o.length===0){w.error("Não há dados para exportar");return}switch(d){case"csv":wa(o),w.success(`${o.length} registros exportados para CSV`);break;case"excel":ka(o),w.success(`${o.length} registros exportados para Excel`);break;case"json":Sa(o),w.success(`${o.length} registros exportados para JSON`);break}}catch(o){w.error("Erro ao exportar: "+o.message)}}return(d,o)=>(y(),M(e(A),null,{default:s(()=>[t(e(ne),null,{default:s(()=>[t(e(de),{class:"flex items-center gap-2"},{default:s(()=>[t(e(pt),{class:"w-5 h-5"}),o[3]||(o[3]=v(" Exportar Dados ",-1))]),_:1})]),_:1}),t(e(B),{class:"space-y-6"},{default:s(()=>[t(e(O),null,{default:s(()=>[t(e(G),{class:"w-4 h-4"}),t(e(F),null,{default:s(()=>[...o[4]||(o[4]=[v("Informação",-1)])]),_:1}),t(e(T),null,{default:s(()=>[v(" Exporte todos os "+h(e(n).totalMetadados)+" metadados cadastrados no formato desejado. ",1)]),_:1})]),_:1}),i("div",$a,[t(e(A),{class:"cursor-pointer transition-all hover:bg-accent",onClick:o[0]||(o[0]=c=>a("csv"))},{default:s(()=>[t(e(B),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:s(()=>[t(e(be),{class:"w-12 h-12 text-muted-foreground"}),o[5]||(o[5]=i("div",{class:"text-lg font-semibold"},"CSV",-1)),o[6]||(o[6]=i("div",{class:"text-sm text-muted-foreground text-center"},"Valores Separados por Vírgula",-1))]),_:1})]),_:1}),t(e(A),{class:"cursor-pointer transition-all hover:bg-accent",onClick:o[1]||(o[1]=c=>a("excel"))},{default:s(()=>[t(e(B),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:s(()=>[t(e(be),{class:"w-12 h-12 text-muted-foreground"}),o[7]||(o[7]=i("div",{class:"text-lg font-semibold"},"Excel",-1)),o[8]||(o[8]=i("div",{class:"text-sm text-muted-foreground text-center"},"Planilha XLSX",-1))]),_:1})]),_:1}),t(e(A),{class:"cursor-pointer transition-all hover:bg-accent",onClick:o[2]||(o[2]=c=>a("json"))},{default:s(()=>[t(e(B),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:s(()=>[t(e(ct),{class:"w-12 h-12 text-muted-foreground"}),o[9]||(o[9]=i("div",{class:"text-lg font-semibold"},"JSON",-1)),o[10]||(o[10]=i("div",{class:"text-sm text-muted-foreground text-center"},"JavaScript Object Notation",-1))]),_:1})]),_:1})]),t(e(Z)),i("div",Ma,[t(e(G),{class:"w-4 h-4"}),o[11]||(o[11]=v(" O arquivo será baixado automaticamente após a exportação ",-1))])]),_:1})]),_:1}))}},Ca={class:"space-y-6"},Da={class:"flex items-center justify-between"},Ua={__name:"ImportExport",setup(r){return(n,a)=>(y(),C("div",Ca,[i("div",Da,[a[1]||(a[1]=i("h1",{class:"text-3xl font-bold"},"Importar/Exportar",-1)),t(e(ze),{variant:"secondary",class:"flex items-center gap-2"},{default:s(()=>[t(e(G),{class:"w-4 h-4"}),a[0]||(a[0]=v(" Gerencie seus dados em diferentes formatos ",-1))]),_:1})]),t(e(Qe),{"default-value":"importar",class:"w-full"},{default:s(()=>[t(e(Ye),{class:"grid w-full grid-cols-3"},{default:s(()=>[t(e(se),{value:"importar",class:"flex items-center gap-2"},{default:s(()=>[t(e(X),{class:"w-4 h-4"}),a[2]||(a[2]=v(" Importar Metadados ",-1))]),_:1}),t(e(se),{value:"exportar",class:"flex items-center gap-2"},{default:s(()=>[t(e(Ie),{class:"w-4 h-4"}),a[3]||(a[3]=v(" Exportar Metadados ",-1))]),_:1}),t(e(se),{value:"backup",class:"flex items-center gap-2"},{default:s(()=>[t(e(He),{class:"w-4 h-4"}),a[4]||(a[4]=v(" Backup Completo ",-1))]),_:1})]),_:1}),t(e(re),{value:"importar",class:"space-y-4 mt-6"},{default:s(()=>[a[5]||(a[5]=i("div",null,[i("h2",{class:"text-xl font-semibold mb-1"},"Importar Metadados"),i("p",{class:"text-sm text-muted-foreground"}," Importe registros de metadados de arquivos CSV, Excel ou JSON ")],-1)),t(xa)]),_:1}),t(e(re),{value:"exportar",class:"space-y-4 mt-6"},{default:s(()=>[a[6]||(a[6]=i("div",null,[i("h2",{class:"text-xl font-semibold mb-1"},"Exportar Apenas Metadados"),i("p",{class:"text-sm text-muted-foreground"}," Exporte somente os registros de metadados em diferentes formatos ")],-1)),t(qa)]),_:1}),t(e(re),{value:"backup",class:"space-y-4 mt-6"},{default:s(()=>[a[7]||(a[7]=i("div",null,[i("h2",{class:"text-xl font-semibold mb-1"},"Backup Completo do Sistema"),i("p",{class:"text-sm text-muted-foreground"}," Exporte e importe todos os dados do sistema incluindo configurações e histórico ")],-1)),t(oa)]),_:1})]),_:1})]))}};export{Ua as default};
