import{c as e,X as a,d as t,I as o,Q as s,H as r,b as l,e as d,f as n,g as i,J as u,K as c,l as p,L as m,N as f,P as v,G as g,k as h,r as y,ar as x,M as b,O as w,ak as _,a2 as k,aj as q,Z as j,ao as M,m as S,u as D,at as C,j as I,p as A,B as $,C as E,z as B,a7 as R,F as N,ag as V,q as P,E as T,D as O}from"./index-q7AElgBj.js";import{d as U,v as L,e as F,p as H,f as z,g as J,u as G,w as K,a as X,b as Z,c as W,_ as Y}from"./importHelpers-BYS6--Tw.js";import{_ as Q,a as ee,b as ae,c as te}from"./CardTitle-Cx4kFn00.js";import{b as oe,R as se,_ as re,a as le,U as de}from"./index-DMsEPRd8.js";import{_ as ne,a as ie,b as ue,c as ce,d as pe}from"./DialogTitle-C3dhr0Sv.js";import{_ as me}from"./DialogDescription-BiUkz3v4.js";import{_ as fe}from"./Label-3oUe5xlR.js";import{u as ve,c as ge,i as he,C as ye}from"./Collection-CmN51-D3.js";import{V as xe,D as be}from"./VisuallyHiddenInput-Bh_-9-hA.js";import{T as we,_ as _e}from"./Progress-COKEEEpT.js";import{_ as ke}from"./Separator-B0Ng24Jn.js";import{I as qe}from"./info-CKFBU8TG.js";import{_ as je,a as Me,b as Se,c as De,d as Ce}from"./TableRow-C7esiANn.js";import{_ as Ie,a as Ae}from"./TableHeader-BZNKJkb8.js";import"./utils-DgVlmcvL.js";import"./nullish-aV-w2MPu.js";
/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=e("file-input",[["path",{d:"M4 22h14a2 2 0 0 0 2-2V7l-5-5H6a2 2 0 0 0-2 2v4",key:"1pf5j1"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M2 15h10",key:"jfw4w8"}],["path",{d:"m9 18 3-3-3-3",key:"112psh"}]]),Ee=e("file-json",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]),Be=e("file-output",[["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M4 7V4a2 2 0 0 1 2-2 2 2 0 0 0-2 2",key:"1vk7w2"}],["path",{d:"M4.063 20.999a2 2 0 0 0 2 1L18 22a2 2 0 0 0 2-2V7l-5-5H6",key:"1jink5"}],["path",{d:"m5 11-3 3",key:"1dgrs4"}],["path",{d:"m5 17-3-3h10",key:"1mvvaf"}]]),Re=e("file-spreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);
/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ne=t({__name:"Radio",props:{id:{type:String,required:!1},value:{type:null,required:!1},disabled:{type:Boolean,required:!1,default:!1},checked:{type:Boolean,required:!1,default:void 0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["update:checked","select"],setup(e,{emit:t}){const g=e,h=t,y=o(g,"checked",h,{passive:void 0===g.checked}),{value:x}=s(g),{forwardRef:b,currentElement:w}=r(),_=ve(w),k=l(()=>g.id&&w.value?document.querySelector(`[for="${g.id}"]`)?.innerText??g.value:void 0);function q(e){g.disabled||function(e,t,o){a("radio.select",o,{originalEvent:e,value:t})}(e,g.value,e=>{h("select",e),e?.defaultPrevented||(y.value=!0,_.value&&e.stopPropagation())})}return(e,a)=>(n(),d(p(v),m(e.$attrs,{id:e.id,ref:p(b),role:"radio",type:"button"===e.as?"button":void 0,as:e.as,"aria-checked":p(y),"aria-label":k.value,"as-child":e.asChild,disabled:e.disabled?"":void 0,"data-state":p(y)?"checked":"unchecked","data-disabled":e.disabled?"":void 0,value:p(x),required:e.required,name:e.name,onClick:f(q,["stop"])}),{default:i(()=>[u(e.$slots,"default",{checked:p(y)}),p(_)&&e.name?(n(),d(p(xe),{key:0,type:"radio",tabindex:"-1",value:p(x),checked:!!p(y),name:e.name,disabled:e.disabled,required:e.required},null,8,["value","checked","name","disabled","required"])):c("v-if",!0)]),_:3},16,["id","type","as","aria-checked","aria-label","as-child","disabled","data-state","data-disabled","value","required","name"]))}});const[Ve,Pe]=g("RadioGroupRoot");var Te=t({__name:"RadioGroupRoot",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},disabled:{type:Boolean,required:!1,default:!1},orientation:{type:String,required:!1,default:void 0},dir:{type:String,required:!1},loop:{type:Boolean,required:!1,default:!0},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1,default:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,l=a,{forwardRef:m,currentElement:f}=r(),g=o(t,"modelValue",l,{defaultValue:t.defaultValue,passive:void 0===t.modelValue}),{disabled:y,loop:x,orientation:b,name:w,required:_,dir:k}=s(t),q=ge(k),j=ve(f);return Pe({modelValue:g,changeModelValue:e=>{g.value=e},disabled:y,loop:x,orientation:b,name:w?.value,required:_}),(e,a)=>(n(),d(p(oe),{"as-child":"",orientation:p(b),dir:p(q),loop:p(x)},{default:i(()=>[h(p(v),{ref:p(m),role:"radiogroup","data-disabled":p(y)?"":void 0,"as-child":e.asChild,as:e.as,"aria-orientation":p(b),"aria-required":p(_),dir:p(q)},{default:i(()=>[u(e.$slots,"default",{modelValue:p(g)}),p(j)&&p(w)?(n(),d(p(xe),{key:0,required:p(_),disabled:p(y),value:p(g),name:p(w)},null,8,["required","disabled","value","name"])):c("v-if",!0)]),_:3},8,["data-disabled","as-child","as","aria-orientation","aria-required","dir"])]),_:3},8,["orientation","dir","loop"]))}});const[Oe,Ue]=g("RadioGroupItem");var Le=t({inheritAttrs:!1,__name:"RadioGroupItem",props:{id:{type:String,required:!1},value:{type:null,required:!1},disabled:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"button"},name:{type:String,required:!1},required:{type:Boolean,required:!1}},emits:["select"],setup(e,{emit:a}){const t=e,o=a,{forwardRef:s,currentElement:c}=r(),v=Ve(),g=l(()=>v.disabled.value||t.disabled),w=l(()=>v.required.value||t.required),_=l(()=>he(v.modelValue?.value,t.value));Ue({disabled:g,checked:_});const k=y(!1),q=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"];function j(){setTimeout(()=>{k.value&&c.value?.click()},0)}return x("keydown",e=>{q.includes(e.key)&&(k.value=!0)}),x("keyup",()=>{k.value=!1}),(e,a)=>(n(),d(p(se),{checked:_.value,disabled:g.value,"as-child":"",focusable:!g.value,active:_.value},{default:i(()=>[h(Ne,m({...e.$attrs,...t},{ref:p(s),checked:_.value,required:w.value,disabled:g.value,"onUpdate:checked":a[0]||(a[0]=a=>p(v).changeModelValue(e.value)),onSelect:a[1]||(a[1]=e=>o("select",e)),onKeydown:a[2]||(a[2]=b(f(()=>{},["prevent"]),["enter"])),onFocus:j}),{default:i(()=>[u(e.$slots,"default",{checked:_.value,required:w.value,disabled:g.value})]),_:3},16,["checked","required","disabled"])]),_:3},8,["checked","disabled","focusable","active"]))}}),Fe=t({__name:"RadioGroupIndicator",props:{forceMount:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1,default:"span"}},setup(e){const{forwardRef:a}=r(),t=Oe();return(e,o)=>(n(),d(p(w),{present:e.forceMount||p(t).checked.value},{default:i(()=>[h(p(v),m({ref:p(a),"data-state":p(t).checked.value?"checked":"unchecked","data-disabled":p(t).disabled.value?"":void 0,"as-child":e.asChild,as:e.as},e.$attrs),{default:i(()=>[u(e.$slots,"default")]),_:3},16,["data-state","data-disabled","as-child","as"])]),_:3},8,["present"]))}});const He={__name:"RadioGroup",props:{modelValue:{type:null,required:!1},defaultValue:{type:null,required:!1},disabled:{type:Boolean,required:!1},orientation:{type:String,required:!1},dir:{type:String,required:!1},loop:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1},class:{type:null,required:!1}},emits:["update:modelValue"],setup(e,{emit:a}){const t=e,o=a,s=_(t,"class"),r=k(s,o);return(e,a)=>(n(),d(p(Te),m({class:p(q)("grid gap-2",t.class)},p(r)),{default:i(()=>[u(e.$slots,"default")]),_:3},16,["class"]))}},ze={__name:"RadioGroupItem",props:{id:{type:String,required:!1},value:{type:null,required:!1},disabled:{type:Boolean,required:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1},name:{type:String,required:!1},required:{type:Boolean,required:!1},class:{type:null,required:!1}},setup(e){const a=e,t=_(a,"class"),o=j(t);return(e,t)=>(n(),d(p(Le),m(p(o),{class:p(q)("peer aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a.class)}),{default:i(()=>[h(p(Fe),{class:"flex items-center justify-center"},{default:i(()=>[h(p(ye),{class:"h-3.5 w-3.5 text-primary"})]),_:1})]),_:1},16,["class"]))}};function Je(e){if(!e)return"Data desconhecida";const a=new Date(e);return`${String(a.getDate()).padStart(2,"0")}/${String(a.getMonth()+1).padStart(2,"0")}/${a.getFullYear()} às ${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`}const Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ke={class:"flex items-center gap-2 text-sm text-muted-foreground"},Xe={key:0,class:"space-y-4 py-4"},Ze={class:"rounded-lg border p-4 space-y-2"},We={class:"grid grid-cols-2 gap-2 text-sm"},Ye={class:"font-semibold"},Qe={class:"text-sm space-y-1"},ea={class:"flex justify-between"},aa={class:"font-medium"},ta={class:"flex justify-between"},oa={class:"font-medium"},sa={class:"flex justify-between"},ra={class:"font-medium"},la={class:"flex justify-between"},da={class:"font-medium"},na={class:"flex justify-between"},ia={class:"font-medium"},ua={class:"flex justify-between"},ca={class:"font-medium"},pa={class:"space-y-3"},ma={class:"flex-1"},fa={class:"flex-1"},va={class:"space-y-4 py-4"},ga={class:"text-center text-sm text-muted-foreground"},ha={__name:"BackupCard",setup(e){const{exportAll:a,importAll:t,clearAll:o}=M(),s=S(),r=D(),l=C(),u=y(null),m=y(!1),f=y(!1),v=y(!1),g=y("merge"),x=y(null),b=y(null),w=y({current:0,total:0});async function _(){try{V.info("Preparando backup...");const e=await a(),t={version:"1.0",exportDate:(new Date).toISOString(),appVersion:"4.0",totalRecords:{metadados:e.metadados.length,config:e.config.length,classesProcessuais:e.classesProcessuais.length,tiposDocumentosImportados:e.tiposDocumentosImportados.length,history:e.history.length,tags:e.tags.length},data:e},o=JSON.stringify(t,null,2),s=new Blob([o],{type:"application/json"}),r=function(e){if(0===e)return"0 Bytes";const a=Math.floor(Math.log(e)/Math.log(1024));return Math.round(e/Math.pow(1024,a)*100)/100+" "+["Bytes","KB","MB","GB"][a]}(s.size),l=URL.createObjectURL(s),d=document.createElement("a");d.href=l,d.download=function(){const e=new Date;return`backup-metadados-${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}-${String(e.getHours()).padStart(2,"0")}${String(e.getMinutes()).padStart(2,"0")}${String(e.getSeconds()).padStart(2,"0")}.json`}(),d.click(),URL.revokeObjectURL(l);const n=Object.values(t.totalRecords).reduce((e,a)=>e+a,0);V.success(`Backup exportado com sucesso! ${n} registros (${r})`)}catch(e){V.error("Erro ao exportar backup: "+e.message)}}function k(){u.value?.click()}async function q(e){const a=e.target.files?.[0];if(a)try{v.value=!0;try{L(a)}catch(t){return V.error(t.message),v.value=!1,void(u.value&&(u.value.value=""))}V.info("Lendo arquivo de backup...");const e=await a.text(),o=JSON.parse(e),s=function(e){try{return e&&"object"==typeof e?e.version?e.data&&"object"==typeof e.data?["metadados","config","history","tags"].some(a=>e.data[a]&&Array.isArray(e.data[a]))?{valid:!0}:{valid:!1,error:"Nenhuma tabela válida encontrada no backup"}:{valid:!1,error:"Dados do backup não encontrados"}:{valid:!1,error:"Versão do backup não encontrada"}:{valid:!1,error:"Arquivo inválido"}}catch(t){return{valid:!1,error:"Erro ao validar backup: "+t.message}}}(o);if(!s.valid)return void V.error(s.error);x.value=function(e){if(!e||!e.data)return null;const a={version:e.version||"Desconhecida",exportDate:e.exportDate?new Date(e.exportDate):null,appVersion:e.appVersion||"Desconhecida",totalRecords:{metadados:e.data.metadados?.length||0,config:e.data.config?.length||0,classesProcessuais:e.data.classesProcessuais?.length||0,tiposDocumentosImportados:e.data.tiposDocumentosImportados?.length||0,history:e.data.history?.length||0,tags:e.data.tags?.length||0}};return a.total=Object.values(a.totalRecords).reduce((e,a)=>e+a,0),a}(o),b.value=o,g.value="merge",m.value=!0,u.value&&(u.value.value="")}catch(t){V.error("Erro ao ler arquivo: "+t.message)}finally{v.value=!1}}function j(){m.value=!1,x.value=null,b.value=null,g.value="merge"}async function P(){if(b.value)try{v.value=!0,m.value=!1,f.value=!0;const e=x.value.total;w.value={current:0,total:e},"replace"===g.value&&(V.info("Criando backup de segurança..."),await _(),V.info("Limpando banco de dados..."),await o()),V.info("Importando dados...");const a=b.value.data,d=["metadados","config","classesProcessuais","tiposDocumentosImportados","history","tags"];let n=0;for(const t of d)a[t]&&a[t].length>0&&(w.value.current=n,await new Promise(e=>setTimeout(e,200))),n+=a[t]?.length||0;await t(a),w.value.current=e,V.info("Atualizando interface..."),await Promise.all([r.loadConfig(),r.loadClassesProcessuais(),r.loadTiposDocumentosImportados(),s.loadMetadados(),l.loadHistory()]),f.value=!1;const i="replace"===g.value?"substituídos":"mesclados";V.success(`Backup importado com sucesso! ${e} registros ${i}`),x.value=null,b.value=null,g.value="merge"}catch(e){f.value=!1,V.error("Erro ao importar backup: "+e.message)}finally{v.value=!1}}return(e,a)=>(n(),I(N,null,[h(p(ee),null,{default:i(()=>[h(p(Q),{class:"space-y-6 pt-6"},{default:i(()=>[h(p(re),null,{default:i(()=>[h(p(qe),{class:"w-4 h-4"}),h(p(U),null,{default:i(()=>[...a[5]||(a[5]=[$("O backup completo inclui",-1)])]),_:1}),h(p(le),null,{default:i(()=>[...a[6]||(a[6]=[A("ul",{class:"list-disc pl-4 space-y-1 mt-2"},[A("li",null,"Todos os metadados cadastrados"),A("li",null,"Configurações (unidades, tipos de documento, formatos)"),A("li",null,"Classes processuais (se carregadas)"),A("li",null,"Tipos de documentos importados (se importados)"),A("li",null,"Histórico completo de alterações")],-1)])]),_:1})]),_:1}),A("div",Ge,[h(p(ee),{class:"cursor-pointer transition-all hover:bg-accent",onClick:_},{default:i(()=>[h(p(Q),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:i(()=>[h(p(be),{class:"w-12 h-12 text-muted-foreground"}),a[7]||(a[7]=A("div",{class:"text-lg font-semibold"},"Exportar Backup",-1)),a[8]||(a[8]=A("div",{class:"text-sm text-muted-foreground text-center"}," Salvar cópia completa do banco de dados ",-1))]),_:1})]),_:1}),h(p(ee),{class:"cursor-pointer transition-all hover:bg-accent",onClick:k},{default:i(()=>[h(p(Q),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:i(()=>[h(p(de),{class:"w-12 h-12 text-muted-foreground"}),a[9]||(a[9]=A("div",{class:"text-lg font-semibold"},"Importar Backup",-1)),a[10]||(a[10]=A("div",{class:"text-sm text-muted-foreground text-center"}," Restaurar dados de um backup anterior ",-1))]),_:1})]),_:1})]),A("input",{ref_key:"fileInputRef",ref:u,type:"file",accept:".json",class:"hidden",onChange:q},null,544),h(p(ke)),A("div",Ke,[h(p(E),{class:"w-4 h-4"}),a[11]||(a[11]=$(" Formato: JSON com todas as tabelas do banco de dados ",-1))])]),_:1})]),_:1}),h(p(pe),{open:m.value,"onUpdate:open":a[3]||(a[3]=e=>m.value=e)},{default:i(()=>[h(p(ne),{class:"max-w-2xl"},{default:i(()=>[h(p(ie),null,{default:i(()=>[h(p(ue),null,{default:i(()=>[...a[12]||(a[12]=[$("Importar Backup Completo",-1)])]),_:1}),h(p(me),null,{default:i(()=>[...a[13]||(a[13]=[$(" Escolha como deseja importar os dados do backup ",-1)])]),_:1})]),_:1}),x.value?(n(),I("div",Xe,[A("div",Ze,[a[23]||(a[23]=A("div",{class:"font-semibold"},"Informações do Backup",-1)),A("div",We,[a[14]||(a[14]=A("div",{class:"text-muted-foreground"},"Data do backup:",-1)),A("div",null,B(p(Je)(x.value.exportDate)),1),a[15]||(a[15]=A("div",{class:"text-muted-foreground"},"Versão:",-1)),A("div",null,B(x.value.version),1),a[16]||(a[16]=A("div",{class:"text-muted-foreground"},"Total de registros:",-1)),A("div",Ye,B(x.value.total),1)]),h(p(ke),{class:"my-3"}),A("div",Qe,[A("div",ea,[a[17]||(a[17]=A("span",{class:"text-muted-foreground"},"Metadados:",-1)),A("span",aa,B(x.value.totalRecords.metadados),1)]),A("div",ta,[a[18]||(a[18]=A("span",{class:"text-muted-foreground"},"Configurações:",-1)),A("span",oa,B(x.value.totalRecords.config),1)]),A("div",sa,[a[19]||(a[19]=A("span",{class:"text-muted-foreground"},"Classes Processuais:",-1)),A("span",ra,B(x.value.totalRecords.classesProcessuais),1)]),A("div",la,[a[20]||(a[20]=A("span",{class:"text-muted-foreground"},"Tipos de Documentos Importados:",-1)),A("span",da,B(x.value.totalRecords.tiposDocumentosImportados),1)]),A("div",na,[a[21]||(a[21]=A("span",{class:"text-muted-foreground"},"Histórico:",-1)),A("span",ia,B(x.value.totalRecords.history),1)]),A("div",ua,[a[22]||(a[22]=A("span",{class:"text-muted-foreground"},"Tags:",-1)),A("span",ca,B(x.value.totalRecords.tags),1)])])]),A("div",pa,[h(p(fe),null,{default:i(()=>[...a[24]||(a[24]=[$("Modo de Importação",-1)])]),_:1}),h(p(He),{modelValue:g.value,"onUpdate:modelValue":a[2]||(a[2]=e=>g.value=e)},{default:i(()=>[A("div",{class:"flex items-start space-x-3 rounded-lg border p-4 cursor-pointer hover:bg-accent",onClick:a[0]||(a[0]=e=>g.value="merge")},[h(p(ze),{value:"merge",id:"merge"}),A("div",ma,[h(p(fe),{for:"merge",class:"cursor-pointer font-semibold"},{default:i(()=>[...a[25]||(a[25]=[$(" Mesclar Dados ",-1)])]),_:1}),a[26]||(a[26]=A("p",{class:"text-sm text-muted-foreground mt-1"}," Adiciona novos registros e atualiza os existentes. Nenhum dado será removido. ",-1))])]),A("div",{class:"flex items-start space-x-3 rounded-lg border p-4 cursor-pointer hover:bg-accent",onClick:a[1]||(a[1]=e=>g.value="replace")},[h(p(ze),{value:"replace",id:"replace"}),A("div",fa,[h(p(fe),{for:"replace",class:"cursor-pointer font-semibold text-destructive"},{default:i(()=>[...a[27]||(a[27]=[$(" Substituir Tudo ",-1)])]),_:1}),a[28]||(a[28]=A("p",{class:"text-sm text-muted-foreground mt-1"}," Remove todos os dados atuais e substitui pelos dados do backup. Esta ação é irreversível! ",-1))])])]),_:1},8,["modelValue"])]),"replace"===g.value?(n(),d(p(re),{key:0,variant:"destructive"},{default:i(()=>[h(p(E),{class:"w-4 h-4"}),h(p(U),null,{default:i(()=>[...a[29]||(a[29]=[$("ATENÇÃO: Ação Irreversível!",-1)])]),_:1}),h(p(le),null,{default:i(()=>[...a[30]||(a[30]=[$(" Todos os dados atuais serão permanentemente apagados, incluindo metadados, configurações e histórico. Recomendamos fazer um backup antes de prosseguir. ",-1)])]),_:1})]),_:1})):c("",!0)])):c("",!0),h(p(ce),null,{default:i(()=>[h(p(R),{variant:"outline",onClick:j},{default:i(()=>[...a[31]||(a[31]=[$(" Cancelar ",-1)])]),_:1}),"merge"===g.value?(n(),d(p(R),{key:0,onClick:P,disabled:v.value},{default:i(()=>[h(p(de),{class:"w-4 h-4 mr-2"}),a[32]||(a[32]=$(" Confirmar Mesclagem ",-1))]),_:1},8,["disabled"])):(n(),d(p(R),{key:1,variant:"destructive",onClick:P,disabled:v.value},{default:i(()=>[h(p(we),{class:"w-4 h-4 mr-2"}),a[33]||(a[33]=$(" Sim, Substituir Tudo ",-1))]),_:1},8,["disabled"]))]),_:1})]),_:1})]),_:1},8,["open"]),h(p(pe),{open:f.value,"onUpdate:open":a[4]||(a[4]=e=>f.value=e),closable:!1},{default:i(()=>[h(p(ne),{class:"max-w-md"},{default:i(()=>[h(p(ie),null,{default:i(()=>[h(p(ue),null,{default:i(()=>[...a[34]||(a[34]=[$("Importando Backup",-1)])]),_:1}),h(p(me),null,{default:i(()=>[...a[35]||(a[35]=[$(" Por favor, aguarde enquanto os dados são importados... ",-1)])]),_:1})]),_:1}),A("div",va,[a[36]||(a[36]=A("div",{class:"flex items-center justify-center"},[A("div",{class:"animate-spin rounded-full h-12 w-12 border-4 border-primary border-t-transparent"})],-1)),A("div",ga," Importando "+B(w.value.current)+" de "+B(w.value.total)+" registros... ",1),h(p(_e),{value:w.value.current/w.value.total*100},null,8,["value"])])]),_:1})]),_:1},8,["open"])],64))}},ya={class:"flex items-center gap-2"},xa={key:0},ba={class:"border rounded-md max-h-[300px] overflow-auto"},wa={key:0},_a={key:1},ka={key:0,class:"text-sm text-muted-foreground mt-2"},qa={key:1,class:"space-y-2"},ja={class:"list-disc pl-4 space-y-1"},Ma={key:0,class:"text-xs mt-2"},Sa={class:"list-disc pl-4 space-y-1"},Da={key:0,class:"text-xs mt-2"},Ca={class:"flex items-center gap-2 text-sm text-muted-foreground"},Ia={__name:"ImportCard",setup(e){const a=S(),t=y(null),o=y(null),s=y([]),r=y(null),l=y(!1);async function u(e){const a=e.target.files?.[0];if(a){o.value=a,s.value=[],r.value=null;try{l.value=!0;try{L(a)}catch(t){throw new Error(t.message)}const e=5242880;if(a.size>e)throw new Error(`Arquivo muito grande (max ${e/1024/1024}MB). Arquivo atual: ${(a.size/1024/1024).toFixed(2)}MB`);const o=a.name.split(".").pop().toLowerCase(),d=1e4;if("csv"===o){const e=(await m(a)).split("\n").filter(e=>e.trim());if(e.length>d+1)throw new Error(`Arquivo CSV muito grande (max ${d} registros). Arquivo contém aproximadamente: ${e.length-1} linhas`)}else if("json"===o){const e=(await m(a)).match(/\{[^}]*\}/g);if(e&&e.length>d)throw new Error(`Arquivo JSON muito grande (max ${d} registros). Arquivo contém aproximadamente: ${e.length} objetos`)}const n=await async function(e){const a=e.name.split(".").pop().toLowerCase();return new Promise((t,o)=>{const s=new FileReader;s.onload=async e=>{try{let s;if("csv"===a)s=H(e.target.result);else if("xlsx"===a||"xls"===a)s=z(e.target.result);else{if("json"!==a)return void o(new Error("Formato de arquivo não suportado"));s=J(e.target.result)}t(s)}catch(s){o(s)}},s.onerror=()=>o(new Error("Erro ao ler arquivo")),"xlsx"===a||"xls"===a?s.readAsArrayBuffer(e):s.readAsText(e)})}(a),i=1e4;if(n.length>i)throw new Error(`Muitos registros (max ${i}). Arquivo contém: ${n.length}`);s.value=n,r.value=F(n)}catch(d){V.error("Erro ao ler arquivo: "+d.message)}finally{l.value=!1}}}async function m(e){return new Promise((a,t)=>{const o=new FileReader;o.onload=e=>a(e.target.result),o.onerror=()=>t(new Error("Erro ao ler arquivo")),o.readAsText(e)})}async function f(){if(s.value.length)if(r.value?.errors.length>0)V.error("Corrija os erros antes de importar");else try{l.value=!0;for(const e of s.value)await a.addMetadado(e);V.success(`${s.value.length} registros importados com sucesso!`),t.value&&(t.value.value=""),o.value=null,s.value=[],r.value=null}catch(e){V.error("Erro ao importar: "+e.message)}finally{l.value=!1}else V.error("Nenhum dado para importar")}return(e,a)=>(n(),d(p(ee),null,{default:i(()=>[h(p(ae),null,{default:i(()=>[h(p(te),{class:"flex items-center gap-2"},{default:i(()=>[h(p($e),{class:"w-5 h-5"}),a[0]||(a[0]=$(" Importar Dados ",-1))]),_:1})]),_:1}),h(p(Q),{class:"space-y-4"},{default:i(()=>[h(p(re),{variant:"warning"},{default:i(()=>[h(p(E),{class:"w-4 h-4"}),h(p(U),null,{default:i(()=>[...a[1]||(a[1]=[$("Atenção",-1)])]),_:1}),h(p(le),null,{default:i(()=>[...a[2]||(a[2]=[$(" A importação irá adicionar os novos registros aos existentes. Para substituir todos os dados, limpe o banco antes. ",-1)])]),_:1})]),_:1}),A("div",ya,[h(p(je),{ref_key:"fileInputRef",ref:t,type:"file",accept:".csv,.xlsx,.xls,.json",disabled:l.value,onChange:u,class:"flex-1"},null,8,["disabled"]),h(p(R),{disabled:!o.value||l.value,onClick:f},{default:i(()=>[h(p(de),{class:"w-4 h-4 mr-2"}),a[3]||(a[3]=$(" Importar ",-1))]),_:1},8,["disabled"])]),s.value.length>0?(n(),I("div",xa,[h(p(ee),null,{default:i(()=>[h(p(ae),null,{default:i(()=>[h(p(te),{class:"text-lg"},{default:i(()=>[$(" Pré-visualização ("+B(s.value.length)+" registros) ",1)]),_:1})]),_:1}),h(p(Q),null,{default:i(()=>[A("div",ba,[h(p(Me),null,{default:i(()=>[h(p(Ie),null,{default:i(()=>[h(p(Se),null,{default:i(()=>[h(p(Ae),null,{default:i(()=>[...a[4]||(a[4]=[$("Unidade",-1)])]),_:1}),h(p(Ae),null,{default:i(()=>[...a[5]||(a[5]=[$("Tipo Documento",-1)])]),_:1}),h(p(Ae),null,{default:i(()=>[...a[6]||(a[6]=[$("Nome Metadado",-1)])]),_:1}),h(p(Ae),null,{default:i(()=>[...a[7]||(a[7]=[$("Tipo",-1)])]),_:1})]),_:1})]),_:1}),h(p(De),null,{default:i(()=>[(n(!0),I(N,null,P(s.value.slice(0,10),(e,a)=>(n(),d(p(Se),{key:a},{default:i(()=>[h(p(Ce),null,{default:i(()=>[$(B(e.unidade),1)]),_:2},1024),h(p(Ce),null,{default:i(()=>[Array.isArray(e.tipoDocumento)?(n(),I("span",wa,B(e.tipoDocumento.join(", ")),1)):(n(),I("span",_a,B(e.tipoDocumento),1))]),_:2},1024),h(p(Ce),null,{default:i(()=>[$(B(e.nomeMetadado),1)]),_:2},1024),h(p(Ce),null,{default:i(()=>[$(B(e.tipoMetadados),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})]),s.value.length>10?(n(),I("p",ka," Mostrando 10 de "+B(s.value.length)+" registros ",1)):c("",!0)]),_:1})]),_:1})])):c("",!0),r.value?(n(),I("div",qa,[r.value.errors.length>0?(n(),d(p(re),{key:0,variant:"destructive"},{default:i(()=>[h(p(E),{class:"w-4 h-4"}),h(p(U),null,{default:i(()=>[$(B(r.value.errors.length)+" "+B(1===r.value.errors.length?"erro encontrado":"erros encontrados"),1)]),_:1}),h(p(le),null,{default:i(()=>[A("ul",ja,[(n(!0),I(N,null,P(r.value.errors.slice(0,5),(e,a)=>(n(),I("li",{key:a},B(e),1))),128))]),r.value.errors.length>5?(n(),I("p",Ma," ... e mais "+B(r.value.errors.length-5)+" erros ",1)):c("",!0)]),_:1})]),_:1})):c("",!0),r.value.warnings.length>0?(n(),d(p(re),{key:1,variant:"warning"},{default:i(()=>[h(p(E),{class:"w-4 h-4"}),h(p(U),null,{default:i(()=>[$(B(r.value.warnings.length)+" "+B(1===r.value.warnings.length?"aviso":"avisos"),1)]),_:1}),h(p(le),null,{default:i(()=>[A("ul",Sa,[(n(!0),I(N,null,P(r.value.warnings.slice(0,3),(e,a)=>(n(),I("li",{key:a},B(e),1))),128))]),r.value.warnings.length>3?(n(),I("p",Da," ... e mais "+B(r.value.warnings.length-3)+" avisos ",1)):c("",!0)]),_:1})]),_:1})):c("",!0)])):c("",!0),h(p(ke)),A("div",Ca,[h(p(qe),{class:"w-4 h-4"}),a[8]||(a[8]=$(" Formatos suportados: CSV, Excel (.xlsx, .xls), JSON ",-1))])]),_:1})]),_:1}))}};function Aa(e){let a=e.toString();return["=","+","-","@","\t","\r","\n"].some(e=>a.startsWith(e))&&(a="'"+a),a=a.replace(/"/g,'""'),`"${a}"`}function $a(e){if(null==e)return"";const a=String(e);return["=","+","-","@","\t","\r","\n"].some(e=>a.startsWith(e))?"'"+a:a}const Ea={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},Ba={class:"flex items-center gap-2 text-sm text-muted-foreground"},Ra={__name:"ExportCard",setup(e){const a=S();async function t(e){try{const t=a.metadados;if(0===t.length)return void V.error("Não há dados para exportar");switch(e){case"csv":!function(e){const a=e.map(e=>[e.unidade||"",e.metadadoDeProcesso?"Sim":"Não",e.classeProcessual||"Não informado",Array.isArray(e.tipoDocumento)?e.tipoDocumento.join(";"):e.tipoDocumento||"",e.nomeMetadado||"",e.objetivoMetadado||"",e.objetivoNaoInformado?"Sim":"Não",e.formatoMetadado||"",e.admiteMultiplos?"Sim":"Não",e.tipoMetadados||"",e.versaoInicialAtende||"",e.observacao||"",e.imagens&&e.imagens.length>0?`${e.imagens.length} ${1===e.imagens.length?"imagem":"imagens"}`:"—"]);let t=["Unidade","Metadado de Processo","Classe Processual","Tipo de Documento","Nome do Metadado","Objetivo","Objetivo Não Informado","Formato","Admite Múltiplos","Tipo de Metadados","Versão Inicial Atende","Observação","Imagens"].map(Aa).join(",")+"\n";a.forEach(e=>{t+=e.map(Aa).join(",")+"\n"});const o=new Blob([t],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(o),s.download=`metadados_${(new Date).toISOString().split("T")[0]}.csv`,s.click()}(t),V.success(`${t.length} registros exportados para CSV`);break;case"excel":!function(e){const a=e.map(e=>({Unidade:$a(e.unidade),"Metadado de Processo":e.metadadoDeProcesso?"Sim":"Não","Classe Processual":$a(e.classeProcessual||"Não informado"),"Tipo de Documento":$a(Array.isArray(e.tipoDocumento)?e.tipoDocumento.join(";"):e.tipoDocumento),"Nome do Metadado":$a(e.nomeMetadado),Objetivo:$a(e.objetivoMetadado),"Objetivo Não Informado":e.objetivoNaoInformado?"Sim":"Não",Formato:$a(e.formatoMetadado),"Admite Múltiplos":e.admiteMultiplos?"Sim":"Não","Tipo de Metadados":$a(e.tipoMetadados),"Versão Inicial Atende":$a(e.versaoInicialAtende),"Observação":$a(e.observacao),Imagens:e.imagens&&e.imagens.length>0?`${e.imagens.length} ${1===e.imagens.length?"imagem":"imagens"}`:"—"})),t=G.json_to_sheet(a);t["!cols"]=[{wch:15},{wch:20},{wch:35},{wch:30},{wch:30},{wch:40},{wch:18},{wch:20},{wch:18},{wch:18},{wch:22},{wch:40},{wch:15}];const o=[];e.forEach(e=>{(Array.isArray(e.tipoDocumento)?e.tipoDocumento:e.tipoDocumento?[e.tipoDocumento]:["Não especificado"]).forEach(a=>{o.push({"Tipo de Documento":$a(a),"Nome do Metadado":$a(e.nomeMetadado),Unidade:$a(e.unidade),Objetivo:$a(e.objetivoMetadado),"Objetivo Não Informado":e.objetivoNaoInformado?"Sim":"Não",Formato:$a(e.formatoMetadado),"Admite Múltiplos":e.admiteMultiplos?"Sim":"Não","Tipo de Metadados":$a(e.tipoMetadados),"Metadado de Processo":e.metadadoDeProcesso?"Sim":"Não","Versão Inicial Atende":$a(e.versaoInicialAtende),"Observação":$a(e.observacao),"Classe Processual":$a(e.classeProcessual||"Não informado"),Imagens:e.imagens&&e.imagens.length>0?`${e.imagens.length} ${1===e.imagens.length?"imagem":"imagens"}`:"—"})})}),o.sort((e,a)=>{const t=e["Tipo de Documento"].localeCompare(a["Tipo de Documento"]);return 0!==t?t:e["Nome do Metadado"].localeCompare(a["Nome do Metadado"])});const s=G.json_to_sheet(o);s["!cols"]=[{wch:35},{wch:30},{wch:15},{wch:40},{wch:18},{wch:20},{wch:18},{wch:18},{wch:20},{wch:22},{wch:40},{wch:35},{wch:15}];const r=G.book_new();G.book_append_sheet(r,t,"Metadados"),G.book_append_sheet(r,s,"Por Tipo de Documento"),K(r,`metadados_${(new Date).toISOString().split("T")[0]}.xlsx`)}(t),V.success(`${t.length} registros exportados para Excel`);break;case"json":!function(e){const a=JSON.stringify(e,null,2),t=new Blob([a],{type:"application/json"}),o=document.createElement("a");o.href=URL.createObjectURL(t),o.download=`metadados_${(new Date).toISOString().split("T")[0]}.json`,o.click()}(t),V.success(`${t.length} registros exportados para JSON`)}}catch(t){V.error("Erro ao exportar: "+t.message)}}return(e,o)=>(n(),d(p(ee),null,{default:i(()=>[h(p(ae),null,{default:i(()=>[h(p(te),{class:"flex items-center gap-2"},{default:i(()=>[h(p(Be),{class:"w-5 h-5"}),o[3]||(o[3]=$(" Exportar Dados ",-1))]),_:1})]),_:1}),h(p(Q),{class:"space-y-6"},{default:i(()=>[h(p(re),null,{default:i(()=>[h(p(qe),{class:"w-4 h-4"}),h(p(U),null,{default:i(()=>[...o[4]||(o[4]=[$("Informação",-1)])]),_:1}),h(p(le),null,{default:i(()=>[$(" Exporte todos os "+B(p(a).totalMetadados)+" metadados cadastrados no formato desejado. ",1)]),_:1})]),_:1}),A("div",Ea,[h(p(ee),{class:"cursor-pointer transition-all hover:bg-accent",onClick:o[0]||(o[0]=e=>t("csv"))},{default:i(()=>[h(p(Q),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:i(()=>[h(p(Re),{class:"w-12 h-12 text-muted-foreground"}),o[5]||(o[5]=A("div",{class:"text-lg font-semibold"},"CSV",-1)),o[6]||(o[6]=A("div",{class:"text-sm text-muted-foreground text-center"},"Valores Separados por Vírgula",-1))]),_:1})]),_:1}),h(p(ee),{class:"cursor-pointer transition-all hover:bg-accent",onClick:o[1]||(o[1]=e=>t("excel"))},{default:i(()=>[h(p(Q),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:i(()=>[h(p(Re),{class:"w-12 h-12 text-muted-foreground"}),o[7]||(o[7]=A("div",{class:"text-lg font-semibold"},"Excel",-1)),o[8]||(o[8]=A("div",{class:"text-sm text-muted-foreground text-center"},"Planilha XLSX",-1))]),_:1})]),_:1}),h(p(ee),{class:"cursor-pointer transition-all hover:bg-accent",onClick:o[2]||(o[2]=e=>t("json"))},{default:i(()=>[h(p(Q),{class:"flex flex-col items-center justify-center py-8 space-y-3"},{default:i(()=>[h(p(Ee),{class:"w-12 h-12 text-muted-foreground"}),o[9]||(o[9]=A("div",{class:"text-lg font-semibold"},"JSON",-1)),o[10]||(o[10]=A("div",{class:"text-sm text-muted-foreground text-center"},"JavaScript Object Notation",-1))]),_:1})]),_:1})]),h(p(ke)),A("div",Ba,[h(p(qe),{class:"w-4 h-4"}),o[11]||(o[11]=$(" O arquivo será baixado automaticamente após a exportação ",-1))])]),_:1})]),_:1}))}},Na={class:"space-y-6"},Va={class:"flex items-center justify-between"},Pa={__name:"ImportExport",setup:e=>(e,a)=>(n(),I("div",Na,[A("div",Va,[a[1]||(a[1]=A("h1",{class:"text-3xl font-bold"},"Importar/Exportar",-1)),h(p(T),{variant:"secondary",class:"flex items-center gap-2"},{default:i(()=>[h(p(qe),{class:"w-4 h-4"}),a[0]||(a[0]=$(" Gerencie seus dados em diferentes formatos ",-1))]),_:1})]),h(p(Y),{"default-value":"importar",class:"w-full"},{default:i(()=>[h(p(X),{class:"grid w-full grid-cols-3"},{default:i(()=>[h(p(Z),{value:"importar",class:"flex items-center gap-2"},{default:i(()=>[h(p(de),{class:"w-4 h-4"}),a[2]||(a[2]=$(" Importar Metadados ",-1))]),_:1}),h(p(Z),{value:"exportar",class:"flex items-center gap-2"},{default:i(()=>[h(p(be),{class:"w-4 h-4"}),a[3]||(a[3]=$(" Exportar Metadados ",-1))]),_:1}),h(p(Z),{value:"backup",class:"flex items-center gap-2"},{default:i(()=>[h(p(O),{class:"w-4 h-4"}),a[4]||(a[4]=$(" Backup Completo ",-1))]),_:1})]),_:1}),h(p(W),{value:"importar",class:"space-y-4 mt-6"},{default:i(()=>[a[5]||(a[5]=A("div",null,[A("h2",{class:"text-xl font-semibold mb-1"},"Importar Metadados"),A("p",{class:"text-sm text-muted-foreground"}," Importe registros de metadados de arquivos CSV, Excel ou JSON ")],-1)),h(Ia)]),_:1}),h(p(W),{value:"exportar",class:"space-y-4 mt-6"},{default:i(()=>[a[6]||(a[6]=A("div",null,[A("h2",{class:"text-xl font-semibold mb-1"},"Exportar Apenas Metadados"),A("p",{class:"text-sm text-muted-foreground"}," Exporte somente os registros de metadados em diferentes formatos ")],-1)),h(Ra)]),_:1}),h(p(W),{value:"backup",class:"space-y-4 mt-6"},{default:i(()=>[a[7]||(a[7]=A("div",null,[A("h2",{class:"text-xl font-semibold mb-1"},"Backup Completo do Sistema"),A("p",{class:"text-sm text-muted-foreground"}," Exporte e importe todos os dados do sistema incluindo configurações e histórico ")],-1)),h(ha)]),_:1})]),_:1})]))};export{Pa as default};
