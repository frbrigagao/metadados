import{c as e,ak as a,r as t,b as l,e as s,f as d,g as o,k as u,u as r,m as n,z as i,A as c,y as m,j as f,J as v,F as p,p as y,a6 as x,al as g,ab as _,x as h,ad as b,am as w}from"./index-DbmskYgF.js";import{b as k,c as D,_ as M,a as j}from"./CardTitle-m65SNR4W.js";import{_ as A,X as V,i as C,e as S,f as T,g as L,a as z,c as B,b as N,d as F,h as H}from"./TableRow-BZwG14sz.js";import{_ as R}from"./Label-CjKkp79l.js";import{_ as U,a as E,b as O,c as q,d as I}from"./SelectValue-DEvP_FJt.js";import{_ as P}from"./Separator-D9pSkOyW.js";import{B as J}from"./building-BabV-zJg.js";import{T as G}from"./trash-2-BAWxtbdl.js";import"./useFormControl-DzSbP6cc.js";
/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=e("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Q=e("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),W=e("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),X={class:"flex items-center justify-between"},Y={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-muted/50 rounded-lg"},Z={class:"space-y-2"},$={class:"space-y-2"},ee={class:"flex items-end"},ae={key:0,class:"flex flex-wrap gap-2 mb-4"},te={key:1,class:"flex flex-col items-center justify-center py-12 text-center"},le={class:"text-xl font-semibold mb-2"},se={class:"text-sm text-muted-foreground"},de={key:2,class:"space-y-8"},oe={class:"text-sm font-semibold text-primary ml-8"},ue={class:"relative space-y-6"},re={class:"flex flex-col items-center"},ne={key:0,class:"w-0.5 flex-1 bg-border mt-2"},ie={class:"flex-1 pb-6"},ce={class:"flex items-center justify-between mb-3"},me={class:"flex items-center gap-2"},fe={class:"text-xs text-muted-foreground"},ve={class:"font-medium mb-1"},pe={key:0,class:"flex items-center gap-1 text-xs text-muted-foreground"},ye={key:0,class:"md:border-l md:pl-4"},xe={class:"text-xs font-medium text-muted-foreground mb-2"},ge={class:"flex flex-wrap gap-1"},_e={class:"space-y-4"},he={class:"grid grid-cols-2 gap-4 p-4 bg-muted/50 rounded-lg"},be={class:"text-sm font-semibold"},we={key:0},ke={class:"text-sm font-semibold mb-3"},De={class:"border rounded-md"},Me={key:1},je={class:"flex items-center justify-between mb-3"},Ae={class:"text-sm font-semibold"},Ve={key:0,class:"p-4 text-center text-sm text-muted-foreground"},Ce={key:1,class:"space-y-4"},Se={class:"font-medium text-sm mb-3"},Te={class:"flex items-center gap-4"},Le={class:"flex-1 space-y-1"},ze={class:"p-3 rounded bg-muted border"},Be={class:"text-sm line-through opacity-70"},Ne={class:"flex items-center justify-center pt-5"},Fe={class:"flex-1 space-y-1"},He={class:"p-3 rounded bg-accent border"},Re={class:"text-sm font-medium"},Ue={class:"group"},Ee={class:"mt-3 border rounded-md"},Oe={__name:"HistoryTimeline",setup(e){const Oe=a(),qe=t(!1),Ie=t(null),Pe=t({nomeMetadado:"",unidade:"__all__"}),Je={unidade:"Unidade",metadadoDeProcesso:"Metadado de Processo",tipoDocumento:"Tipos de Documento",nomeMetadado:"Nome do Metadado",objetivoMetadado:"Objetivo",formatoMetadado:"Formato",admiteMultiplos:"Admite Múltiplos",tipoMetadados:"Tipo de Metadados",versaoInicialAtende:"Versão Inicial Atende",observacao:"Observação"},Ge=l(()=>{let e=Oe.history;if(Pe.value.nomeMetadado.trim()){const a=Pe.value.nomeMetadado.toLowerCase();e=e.filter(e=>(e.data?.nomeMetadado||e.oldData?.nomeMetadado||"").toLowerCase().includes(a))}return Pe.value.unidade&&"__all__"!==Pe.value.unidade&&(e=e.filter(e=>(e.data?.unidade||e.oldData?.unidade)===Pe.value.unidade)),e}),Ke=l(()=>{const e=new Set;return Oe.history.forEach(a=>{const t=a.data?.unidade||a.oldData?.unidade;t&&e.add(t)}),Array.from(e).sort()}),Qe=l(()=>""!==Pe.value.nomeMetadado.trim()||""!==Pe.value.unidade&&"__all__"!==Pe.value.unidade);function We(){Pe.value.nomeMetadado="",Pe.value.unidade="__all__"}const Xe=l(()=>{const e={};return Ge.value.forEach(a=>{const t=new Date(a.timestamp),l=t.toLocaleDateString("pt-BR");e[l]||(e[l]={date:l,dateFormatted:Ye(t),items:[]}),e[l].items.push(a)}),Object.values(e).sort((e,a)=>{const t=new Date(e.items[0].timestamp);return new Date(a.items[0].timestamp)-t})});function Ye(e){const a=new Date,t=new Date(a);t.setDate(t.getDate()-1);const l=e.toLocaleDateString("pt-BR"),s=a.toLocaleDateString("pt-BR"),d=t.toLocaleDateString("pt-BR");return l===s?"Hoje":l===d?"Ontem":l}function Ze(e){if("update"!==e.type||!e.oldData||!e.data)return[];const a=[];return Object.keys(Je).forEach(t=>{var l,s;l=e.oldData[t],s=e.data[t],(Array.isArray(l)&&Array.isArray(s)?l.length===s.length&&l.every((e,a)=>e===s[a]):l===s)||a.push({field:t,label:Je[t],oldValue:e.oldData[t],newValue:e.data[t]})}),a}function $e(e){return null==e?"-":"boolean"==typeof e?e?"Sim":"Não":Array.isArray(e)?e.length>0?e.join(", "):"-":"string"==typeof e&&""===e.trim()?"-":e}function ea(e){switch(e){case"create":return Q;case"update":return W;case"delete":return G;default:return g}}function aa(e){switch(e){case"create":return"Criado";case"update":return"Atualizado";case"delete":return"Excluído";default:return"Desconhecido"}}return(e,a)=>(d(),s(r(j),null,{default:o(()=>[u(r(k),null,{default:o(()=>[n("div",X,[u(r(D),null,{default:o(()=>[...a[6]||(a[6]=[i("Histórico de Alterações",-1)])]),_:1}),u(r(c),{variant:"secondary",class:"text-xs"},{default:o(()=>[i(m(Ge.value.length)+" de "+m(r(Oe).history.length)+" registros ",1)]),_:1})])]),_:1}),u(r(M),null,{default:o(()=>[n("div",Y,[n("div",Z,[u(r(R),{for:"filter-nome"},{default:o(()=>[...a[7]||(a[7]=[i("Nome do Metadado",-1)])]),_:1}),u(r(A),{id:"filter-nome",modelValue:Pe.value.nomeMetadado,"onUpdate:modelValue":a[0]||(a[0]=e=>Pe.value.nomeMetadado=e),placeholder:"Buscar por nome...",class:"w-full"},null,8,["modelValue"])]),n("div",$,[u(r(R),{for:"filter-unidade"},{default:o(()=>[...a[8]||(a[8]=[i("Unidade",-1)])]),_:1}),u(r(U),{modelValue:Pe.value.unidade,"onUpdate:modelValue":a[1]||(a[1]=e=>Pe.value.unidade=e)},{default:o(()=>[u(r(E),{id:"filter-unidade"},{default:o(()=>[u(r(O),{placeholder:"Todas as unidades"})]),_:1}),u(r(q),null,{default:o(()=>[u(r(I),{value:"__all__"},{default:o(()=>[...a[9]||(a[9]=[i("Todas as unidades",-1)])]),_:1}),(d(!0),f(p,null,y(Ke.value,e=>(d(),s(r(I),{key:e,value:e},{default:o(()=>[i(m(e),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),n("div",ee,[u(r(x),{variant:"outline",class:"w-full",onClick:We,disabled:!Qe.value},{default:o(()=>[u(r(V),{class:"w-4 h-4 mr-2"}),a[10]||(a[10]=i(" Limpar Filtros ",-1))]),_:1},8,["disabled"])])]),Qe.value?(d(),f("div",ae,[Pe.value.nomeMetadado?(d(),s(r(c),{key:0,variant:"secondary",class:"gap-1"},{default:o(()=>[i(" Nome: "+m(Pe.value.nomeMetadado)+" ",1),n("button",{onClick:a[2]||(a[2]=e=>Pe.value.nomeMetadado=""),class:"ml-1 hover:text-destructive"},[u(r(V),{class:"w-3 h-3"})])]),_:1})):v("",!0),Pe.value.unidade&&"__all__"!==Pe.value.unidade?(d(),s(r(c),{key:1,variant:"secondary",class:"gap-1"},{default:o(()=>[i(" Unidade: "+m(Pe.value.unidade)+" ",1),n("button",{onClick:a[3]||(a[3]=e=>Pe.value.unidade="__all__"),class:"ml-1 hover:text-destructive"},[u(r(V),{class:"w-3 h-3"})])]),_:1})):v("",!0)])):v("",!0),0===Xe.value.length?(d(),f("div",te,[u(r(g),{class:"w-16 h-16 text-muted-foreground mb-4"}),n("h3",le,m(Qe.value?"Nenhum resultado encontrado":"Nenhuma alteração registrada"),1),n("p",se,m(Qe.value?"Tente ajustar os filtros de busca":"As ações realizadas aparecerão aqui"),1)])):(d(),f("div",de,[(d(!0),f(p,null,y(Xe.value,e=>(d(),f("div",{key:e.date,class:"space-y-4"},[n("div",oe,m(e.dateFormatted),1),n("div",ue,[(d(!0),f(p,null,y(e.items,(t,l)=>(d(),f("div",{key:t.id,class:"relative flex gap-4"},[n("div",re,[n("div",{class:_(["w-8 h-8 rounded-full flex items-center justify-center z-10",(t.type,"bg-primary")])},[(d(),s(h(ea(t.type)),{class:"w-4 h-4 text-white"}))],2),l<e.items.length-1?(d(),f("div",ne)):v("",!0)]),n("div",ie,[u(r(j),{class:_((t.type,""))},{default:o(()=>[u(r(M),{class:"p-4"},{default:o(()=>{return[n("div",ce,[n("div",me,[u(r(c),{variant:(t.type,"secondary")},{default:o(()=>[i(m(aa(t.type)),1)]),_:2},1032,["variant"]),n("span",fe,m((e=t.timestamp,new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}))),1)]),u(r(x),{variant:"ghost",size:"sm",onClick:e=>function(e){Ie.value=e,qe.value=!0}(t)},{default:o(()=>[...a[11]||(a[11]=[i(" Detalhes ",-1)])]),_:1},8,["onClick"])]),n("div",{class:_("update"===t.type?"grid grid-cols-1 md:grid-cols-2 gap-4":"")},[n("div",null,[n("div",ve,m(t.data?.nomeMetadado||t.oldData?.nomeMetadado||"Sem nome"),1),t.data?.unidade?(d(),f("div",pe,[u(r(J),{class:"w-3 h-3"}),i(" "+m(t.data.unidade),1)])):v("",!0)]),"update"===t.type?(d(),f("div",ye,[n("div",xe," Campos alterados ("+m(Ze(t).length)+") ",1),n("div",ge,[(d(!0),f(p,null,y(Ze(t).slice(0,5),e=>(d(),s(r(c),{key:e.field,variant:"outline",class:"text-xs"},{default:o(()=>[i(m(e.label),1)]),_:2},1024))),128)),Ze(t).length>5?(d(),s(r(c),{key:0,variant:"outline",class:"text-xs"},{default:o(()=>[i(" +"+m(Ze(t).length-5)+" mais ",1)]),_:2},1024)):v("",!0)])])):v("",!0)],2)];var e}),_:2},1024)]),_:2},1032,["class"])])]))),128))])]))),128))]))]),_:1}),u(r(C),{open:qe.value,"onUpdate:open":a[5]||(a[5]=e=>qe.value=e)},{default:o(()=>[Ie.value?(d(),s(r(S),{key:0,class:"max-w-4xl max-h-[90vh] overflow-y-auto"},{default:o(()=>[u(r(T),null,{default:o(()=>[u(r(L),{class:"flex items-center gap-2"},{default:o(()=>[(d(),s(h(ea(Ie.value.type)),{class:"w-5 h-5"})),i(" "+m(aa(Ie.value.type))+" - Detalhes Completos ",1)]),_:1})]),_:1}),n("div",_e,[n("div",he,[n("div",null,[a[12]||(a[12]=n("p",{class:"text-sm font-medium text-muted-foreground"},"Data/Hora",-1)),n("p",be,m(new Date(Ie.value.timestamp).toLocaleString("pt-BR")),1)]),n("div",null,[a[13]||(a[13]=n("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo de Ação",-1)),u(r(c),{variant:(Ie.value.type,"secondary")},{default:o(()=>[i(m(aa(Ie.value.type)),1)]),_:1},8,["variant"])])]),u(r(P)),"update"!==Ie.value.type?(d(),f("div",we,[n("h4",ke," Dados "+m("delete"===Ie.value.type?"Excluídos":"Criados"),1),n("div",De,[u(r(z),null,{default:o(()=>[u(r(B),null,{default:o(()=>[(d(),f(p,null,y(Je,(e,a)=>u(r(N),{key:a},{default:o(()=>[u(r(F),{class:"font-medium w-1/3"},{default:o(()=>[i(m(e)+":",1)]),_:2},1024),u(r(F),null,{default:o(()=>[i(m($e("delete"===Ie.value.type?Ie.value.oldData?.[a]:Ie.value.data?.[a])),1)]),_:2},1024)]),_:2},1024)),64))]),_:1})]),_:1})])])):v("",!0),"update"===Ie.value.type?(d(),f("div",Me,[n("div",je,[n("h4",Ae," Campos Alterados ("+m(Ze(Ie.value).length)+") ",1),u(r(c),{variant:"outline"},{default:o(()=>[i(m(Ze(Ie.value).length)+" modificações ",1)]),_:1})]),0===Ze(Ie.value).length?(d(),f("div",Ve," Nenhum campo foi alterado ")):(d(),f("div",Ce,[(d(!0),f(p,null,y(Ze(Ie.value),e=>(d(),f("div",{key:e.field,class:"border rounded-lg p-4"},[n("div",Se,m(e.label),1),n("div",Te,[n("div",Le,[a[14]||(a[14]=n("div",{class:"text-xs text-muted-foreground font-medium"},"Valor Anterior",-1)),n("div",ze,[n("span",Be,m($e(e.oldValue)),1)])]),n("div",Ne,[u(r(K),{class:"w-5 h-5 text-muted-foreground flex-shrink-0"})]),n("div",Fe,[a[15]||(a[15]=n("div",{class:"text-xs text-muted-foreground font-medium"},"Valor Novo",-1)),n("div",He,[n("span",Re,m($e(e.newValue)),1)])])])]))),128))])),u(r(P),{class:"my-4"}),n("details",Ue,[a[16]||(a[16]=n("summary",{class:"cursor-pointer text-sm font-medium text-muted-foreground hover:text-foreground"}," Ver campos não alterados ",-1)),n("div",Ee,[u(r(z),null,{default:o(()=>[u(r(B),null,{default:o(()=>[(d(),f(p,null,y(Je,(e,a)=>b(u(r(N),{key:a},{default:o(()=>[u(r(F),{class:"font-medium w-1/3"},{default:o(()=>[i(m(e)+":",1)]),_:2},1024),u(r(F),null,{default:o(()=>[i(m($e(Ie.value.data?.[a])),1)]),_:2},1024)]),_:2},1024),[[w,!Ze(Ie.value).some(e=>e.field===a)]])),64))]),_:1})]),_:1})])])])):v("",!0)]),u(r(H),null,{default:o(()=>[u(r(x),{variant:"ghost",onClick:a[4]||(a[4]=e=>qe.value=!1)},{default:o(()=>[...a[17]||(a[17]=[i(" Fechar ",-1)])]),_:1})]),_:1})]),_:1})):v("",!0)]),_:1},8,["open"])]),_:1}))}},qe={class:"space-y-6"},Ie={class:"flex items-center justify-between"},Pe={__name:"Historico",setup:e=>(e,a)=>(d(),f("div",qe,[n("div",Ie,[a[1]||(a[1]=n("h1",{class:"text-3xl font-bold"},"Histórico de Alterações",-1)),u(r(c),{variant:"secondary",class:"flex items-center gap-2"},{default:o(()=>[u(r(g),{class:"w-4 h-4"}),a[0]||(a[0]=i(" Visualize e reverta alterações ",-1))]),_:1})]),u(Oe)]))};
/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{Pe as default};
