import{c as N,ak as oe,r as j,b as A,e as y,f as r,g as n,k as l,u as a,m as s,z as u,A as g,y as i,j as m,J as _,F as h,p as x,a6 as B,al as L,ab as V,x as U,ad as de,am as le}from"./index-CN1f8RHj.js";import{b as ne,c as re,_ as E,a as I}from"./CardTitle-D36P3npu.js";import{_ as ie,X as T,i as ue,e as ce,f as me,g as fe,a as O,c as q,b as P,d as C,h as _e}from"./TableRow-B8jP6L0Y.js";import{_ as J}from"./Label-MuZUBsTR.js";import{_ as pe,a as ve,b as ye,c as ge,d as K}from"./SelectValue-DjZ1GYEM.js";import{_ as X}from"./Separator-ePc3EV8S.js";import{B as he}from"./building-B3vPYBd6.js";import{T as xe}from"./trash-2-DdfL5B7L.js";import"./useFormControl-CVJT89es.js";/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=N("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=N("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]);/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=N("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),De={class:"flex items-center justify-between"},$e={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-muted/50 rounded-lg"},Me={class:"space-y-2"},Ae={class:"space-y-2"},Ce={class:"flex items-end"},Se={key:0,class:"flex flex-wrap gap-2 mb-4"},je={key:1,class:"flex flex-col items-center justify-center py-12 text-center"},Be={class:"text-xl font-semibold mb-2"},Ve={class:"text-sm text-muted-foreground"},Te={key:2,class:"space-y-8"},Le={class:"text-sm font-semibold text-primary ml-8"},Ne={class:"relative space-y-6"},He={class:"flex flex-col items-center"},Fe={key:0,class:"w-0.5 flex-1 bg-border mt-2"},ze={class:"flex-1 pb-6"},Re={class:"flex items-center justify-between mb-3"},Ue={class:"flex items-center gap-2"},Ee={class:"text-xs text-muted-foreground"},Ie={class:"font-medium mb-1"},Oe={key:0,class:"flex items-center gap-1 text-xs text-muted-foreground"},qe={key:0,class:"md:border-l md:pl-4"},Pe={class:"text-xs font-medium text-muted-foreground mb-2"},Je={class:"flex flex-wrap gap-1"},Ke={class:"space-y-4"},Xe={class:"grid grid-cols-2 gap-4 p-4 bg-muted/50 rounded-lg"},Ge={class:"text-sm font-semibold"},Qe={key:0},We={class:"text-sm font-semibold mb-3"},Ye={class:"border rounded-md"},Ze={key:1},et={class:"flex items-center justify-between mb-3"},tt={class:"text-sm font-semibold"},at={key:0,class:"p-4 text-center text-sm text-muted-foreground"},st={key:1,class:"space-y-4"},ot={class:"font-medium text-sm mb-3"},dt={class:"flex items-center gap-4"},lt={class:"flex-1 space-y-1"},nt={class:"p-3 rounded bg-muted border"},rt={class:"text-sm line-through opacity-70"},it={class:"flex items-center justify-center pt-5"},ut={class:"flex-1 space-y-1"},ct={class:"p-3 rounded bg-accent border"},mt={class:"text-sm font-medium"},ft={class:"group"},_t={class:"mt-3 border rounded-md"},pt={__name:"HistoryTimeline",setup(G){const k=oe(),p=j(!1),f=j(null),c=j({nomeMetadado:"",unidade:"__all__"}),D={unidade:"Unidade",metadadoDeProcesso:"Metadado de Processo",tipoDocumento:"Tipos de Documento",nomeMetadado:"Nome do Metadado",objetivoMetadado:"Objetivo",formatoMetadado:"Formato",admiteMultiplos:"Admite Múltiplos",tipoMetadados:"Tipo de Metadados",versaoInicialAtende:"Versão Inicial Atende",observacao:"Observação"},H=A(()=>{let t=k.history;if(c.value.nomeMetadado.trim()){const e=c.value.nomeMetadado.toLowerCase();t=t.filter(d=>(d.data?.nomeMetadado||d.oldData?.nomeMetadado||"").toLowerCase().includes(e))}return c.value.unidade&&c.value.unidade!=="__all__"&&(t=t.filter(e=>(e.data?.unidade||e.oldData?.unidade)===c.value.unidade)),t}),Q=A(()=>{const t=new Set;return k.history.forEach(e=>{const d=e.data?.unidade||e.oldData?.unidade;d&&t.add(d)}),Array.from(t).sort()}),$=A(()=>c.value.nomeMetadado.trim()!==""||c.value.unidade!==""&&c.value.unidade!=="__all__");function W(){c.value.nomeMetadado="",c.value.unidade="__all__"}const F=A(()=>{const t={};return H.value.forEach(e=>{const d=new Date(e.timestamp),o=d.toLocaleDateString("pt-BR");t[o]||(t[o]={date:o,dateFormatted:Y(d),items:[]}),t[o].items.push(e)}),Object.values(t).sort((e,d)=>{const o=new Date(e.items[0].timestamp);return new Date(d.items[0].timestamp)-o})});function Y(t){const e=new Date,d=new Date(e);d.setDate(d.getDate()-1);const o=t.toLocaleDateString("pt-BR"),b=e.toLocaleDateString("pt-BR"),w=d.toLocaleDateString("pt-BR");return o===b?"Hoje":o===w?"Ontem":o}function Z(t,e){return Array.isArray(t)&&Array.isArray(e)?t.length!==e.length?!0:!t.every((d,o)=>d===e[o]):t!==e}function v(t){if(t.type!=="update"||!t.oldData||!t.data)return[];const e=[];return Object.keys(D).forEach(o=>{Z(t.oldData[o],t.data[o])&&e.push({field:o,label:D[o],oldValue:t.oldData[o],newValue:t.data[o]})}),e}function M(t){return t==null?"-":typeof t=="boolean"?t?"Sim":"Não":Array.isArray(t)?t.length>0?t.join(", "):"-":typeof t=="string"&&t.trim()===""?"-":t}function ee(t){switch(t){case"create":return"bg-primary";case"update":return"bg-primary";case"delete":return"bg-primary";default:return"bg-primary"}}function te(t){return""}function z(t){switch(t){case"create":return"secondary";case"update":return"secondary";case"delete":return"secondary";default:return"secondary"}}function R(t){switch(t){case"create":return we;case"update":return ke;case"delete":return xe;default:return L}}function S(t){switch(t){case"create":return"Criado";case"update":return"Atualizado";case"delete":return"Excluído";default:return"Desconhecido"}}function ae(t){return new Date(t).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}function se(t){f.value=t,p.value=!0}return(t,e)=>(r(),y(a(I),null,{default:n(()=>[l(a(ne),null,{default:n(()=>[s("div",De,[l(a(re),null,{default:n(()=>[...e[6]||(e[6]=[u("Histórico de Alterações",-1)])]),_:1}),l(a(g),{variant:"secondary",class:"text-xs"},{default:n(()=>[u(i(H.value.length)+" de "+i(a(k).history.length)+" registros ",1)]),_:1})])]),_:1}),l(a(E),null,{default:n(()=>[s("div",$e,[s("div",Me,[l(a(J),{for:"filter-nome"},{default:n(()=>[...e[7]||(e[7]=[u("Nome do Metadado",-1)])]),_:1}),l(a(ie),{id:"filter-nome",modelValue:c.value.nomeMetadado,"onUpdate:modelValue":e[0]||(e[0]=d=>c.value.nomeMetadado=d),placeholder:"Buscar por nome...",class:"w-full"},null,8,["modelValue"])]),s("div",Ae,[l(a(J),{for:"filter-unidade"},{default:n(()=>[...e[8]||(e[8]=[u("Unidade",-1)])]),_:1}),l(a(pe),{modelValue:c.value.unidade,"onUpdate:modelValue":e[1]||(e[1]=d=>c.value.unidade=d)},{default:n(()=>[l(a(ve),{id:"filter-unidade"},{default:n(()=>[l(a(ye),{placeholder:"Todas as unidades"})]),_:1}),l(a(ge),null,{default:n(()=>[l(a(K),{value:"__all__"},{default:n(()=>[...e[9]||(e[9]=[u("Todas as unidades",-1)])]),_:1}),(r(!0),m(h,null,x(Q.value,d=>(r(),y(a(K),{key:d,value:d},{default:n(()=>[u(i(d),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),s("div",Ce,[l(a(B),{variant:"outline",class:"w-full",onClick:W,disabled:!$.value},{default:n(()=>[l(a(T),{class:"w-4 h-4 mr-2"}),e[10]||(e[10]=u(" Limpar Filtros ",-1))]),_:1},8,["disabled"])])]),$.value?(r(),m("div",Se,[c.value.nomeMetadado?(r(),y(a(g),{key:0,variant:"secondary",class:"gap-1"},{default:n(()=>[u(" Nome: "+i(c.value.nomeMetadado)+" ",1),s("button",{onClick:e[2]||(e[2]=d=>c.value.nomeMetadado=""),class:"ml-1 hover:text-destructive"},[l(a(T),{class:"w-3 h-3"})])]),_:1})):_("",!0),c.value.unidade&&c.value.unidade!=="__all__"?(r(),y(a(g),{key:1,variant:"secondary",class:"gap-1"},{default:n(()=>[u(" Unidade: "+i(c.value.unidade)+" ",1),s("button",{onClick:e[3]||(e[3]=d=>c.value.unidade="__all__"),class:"ml-1 hover:text-destructive"},[l(a(T),{class:"w-3 h-3"})])]),_:1})):_("",!0)])):_("",!0),F.value.length===0?(r(),m("div",je,[l(a(L),{class:"w-16 h-16 text-muted-foreground mb-4"}),s("h3",Be,i($.value?"Nenhum resultado encontrado":"Nenhuma alteração registrada"),1),s("p",Ve,i($.value?"Tente ajustar os filtros de busca":"As ações realizadas aparecerão aqui"),1)])):(r(),m("div",Te,[(r(!0),m(h,null,x(F.value,d=>(r(),m("div",{key:d.date,class:"space-y-4"},[s("div",Le,i(d.dateFormatted),1),s("div",Ne,[(r(!0),m(h,null,x(d.items,(o,b)=>(r(),m("div",{key:o.id,class:"relative flex gap-4"},[s("div",He,[s("div",{class:V(["w-8 h-8 rounded-full flex items-center justify-center z-10",ee(o.type)])},[(r(),y(U(R(o.type)),{class:"w-4 h-4 text-white"}))],2),b<d.items.length-1?(r(),m("div",Fe)):_("",!0)]),s("div",ze,[l(a(I),{class:V(te(o.type))},{default:n(()=>[l(a(E),{class:"p-4"},{default:n(()=>[s("div",Re,[s("div",Ue,[l(a(g),{variant:z(o.type)},{default:n(()=>[u(i(S(o.type)),1)]),_:2},1032,["variant"]),s("span",Ee,i(ae(o.timestamp)),1)]),l(a(B),{variant:"ghost",size:"sm",onClick:w=>se(o)},{default:n(()=>[...e[11]||(e[11]=[u(" Detalhes ",-1)])]),_:1},8,["onClick"])]),s("div",{class:V(o.type==="update"?"grid grid-cols-1 md:grid-cols-2 gap-4":"")},[s("div",null,[s("div",Ie,i(o.data?.nomeMetadado||o.oldData?.nomeMetadado||"Sem nome"),1),o.data?.unidade?(r(),m("div",Oe,[l(a(he),{class:"w-3 h-3"}),u(" "+i(o.data.unidade),1)])):_("",!0)]),o.type==="update"?(r(),m("div",qe,[s("div",Pe," Campos alterados ("+i(v(o).length)+") ",1),s("div",Je,[(r(!0),m(h,null,x(v(o).slice(0,5),w=>(r(),y(a(g),{key:w.field,variant:"outline",class:"text-xs"},{default:n(()=>[u(i(w.label),1)]),_:2},1024))),128)),v(o).length>5?(r(),y(a(g),{key:0,variant:"outline",class:"text-xs"},{default:n(()=>[u(" +"+i(v(o).length-5)+" mais ",1)]),_:2},1024)):_("",!0)])])):_("",!0)],2)]),_:2},1024)]),_:2},1032,["class"])])]))),128))])]))),128))]))]),_:1}),l(a(ue),{open:p.value,"onUpdate:open":e[5]||(e[5]=d=>p.value=d)},{default:n(()=>[f.value?(r(),y(a(ce),{key:0,class:"max-w-4xl max-h-[90vh] overflow-y-auto"},{default:n(()=>[l(a(me),null,{default:n(()=>[l(a(fe),{class:"flex items-center gap-2"},{default:n(()=>[(r(),y(U(R(f.value.type)),{class:"w-5 h-5"})),u(" "+i(S(f.value.type))+" - Detalhes Completos ",1)]),_:1})]),_:1}),s("div",Ke,[s("div",Xe,[s("div",null,[e[12]||(e[12]=s("p",{class:"text-sm font-medium text-muted-foreground"},"Data/Hora",-1)),s("p",Ge,i(new Date(f.value.timestamp).toLocaleString("pt-BR")),1)]),s("div",null,[e[13]||(e[13]=s("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo de Ação",-1)),l(a(g),{variant:z(f.value.type)},{default:n(()=>[u(i(S(f.value.type)),1)]),_:1},8,["variant"])])]),l(a(X)),f.value.type!=="update"?(r(),m("div",Qe,[s("h4",We," Dados "+i(f.value.type==="delete"?"Excluídos":"Criados"),1),s("div",Ye,[l(a(O),null,{default:n(()=>[l(a(q),null,{default:n(()=>[(r(),m(h,null,x(D,(d,o)=>l(a(P),{key:o},{default:n(()=>[l(a(C),{class:"font-medium w-1/3"},{default:n(()=>[u(i(d)+":",1)]),_:2},1024),l(a(C),null,{default:n(()=>[u(i(M(f.value.type==="delete"?f.value.oldData?.[o]:f.value.data?.[o])),1)]),_:2},1024)]),_:2},1024)),64))]),_:1})]),_:1})])])):_("",!0),f.value.type==="update"?(r(),m("div",Ze,[s("div",et,[s("h4",tt," Campos Alterados ("+i(v(f.value).length)+") ",1),l(a(g),{variant:"outline"},{default:n(()=>[u(i(v(f.value).length)+" modificações ",1)]),_:1})]),v(f.value).length===0?(r(),m("div",at," Nenhum campo foi alterado ")):(r(),m("div",st,[(r(!0),m(h,null,x(v(f.value),d=>(r(),m("div",{key:d.field,class:"border rounded-lg p-4"},[s("div",ot,i(d.label),1),s("div",dt,[s("div",lt,[e[14]||(e[14]=s("div",{class:"text-xs text-muted-foreground font-medium"},"Valor Anterior",-1)),s("div",nt,[s("span",rt,i(M(d.oldValue)),1)])]),s("div",it,[l(a(be),{class:"w-5 h-5 text-muted-foreground flex-shrink-0"})]),s("div",ut,[e[15]||(e[15]=s("div",{class:"text-xs text-muted-foreground font-medium"},"Valor Novo",-1)),s("div",ct,[s("span",mt,i(M(d.newValue)),1)])])])]))),128))])),l(a(X),{class:"my-4"}),s("details",ft,[e[16]||(e[16]=s("summary",{class:"cursor-pointer text-sm font-medium text-muted-foreground hover:text-foreground"}," Ver campos não alterados ",-1)),s("div",_t,[l(a(O),null,{default:n(()=>[l(a(q),null,{default:n(()=>[(r(),m(h,null,x(D,(d,o)=>de(l(a(P),{key:o},{default:n(()=>[l(a(C),{class:"font-medium w-1/3"},{default:n(()=>[u(i(d)+":",1)]),_:2},1024),l(a(C),null,{default:n(()=>[u(i(M(f.value.data?.[o])),1)]),_:2},1024)]),_:2},1024),[[le,!v(f.value).some(b=>b.field===o)]])),64))]),_:1})]),_:1})])])])):_("",!0)]),l(a(_e),null,{default:n(()=>[l(a(B),{variant:"ghost",onClick:e[4]||(e[4]=d=>p.value=!1)},{default:n(()=>[...e[17]||(e[17]=[u(" Fechar ",-1)])]),_:1})]),_:1})]),_:1})):_("",!0)]),_:1},8,["open"])]),_:1}))}},vt={class:"space-y-6"},yt={class:"flex items-center justify-between"},At={__name:"Historico",setup(G){return(k,p)=>(r(),m("div",vt,[s("div",yt,[p[1]||(p[1]=s("h1",{class:"text-3xl font-bold"},"Histórico de Alterações",-1)),l(a(g),{variant:"secondary",class:"flex items-center gap-2"},{default:n(()=>[l(a(L),{class:"w-4 h-4"}),p[0]||(p[0]=u(" Visualize e reverta alterações ",-1))]),_:1})]),l(pt)]))}};export{At as default};
