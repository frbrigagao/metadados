import{c as e,at as a,r as t,b as l,e as s,f as d,g as o,k as u,l as i,p as r,B as n,E as c,z as m,j as f,K as v,F as p,q as y,a7 as x,au as g,a8 as _,y as h,ah as b,av as w}from"./index-CC_fJSip.js";import{b as k,c as D,_ as M,a as j}from"./CardTitle-BWpkuWeg.js";import{_ as A,a as C,c as V,b as T,d as S}from"./TableRow-Dfqn-RkX.js";import{_ as L}from"./Label-C3fnbl4G.js";import{_ as B,a as N,b as z,c as H,d as R}from"./SelectValue-DG-nKl7e.js";import{X as E,d as F,_ as U,a as q,b as O,c as I}from"./DialogTitle-BVTcrzdp.js";import{_ as P}from"./Separator-D-1Lk34O.js";import{B as K}from"./building-Dd_K2RT6.js";import{T as G}from"./trash-2-CX3q8yf5.js";import"./utils-hTZID-LI.js";import"./Collection-YrLmKvk0.js";import"./nullish-aV-w2MPu.js";
/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=e("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]),Q=e("circle-plus",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]]),W=e("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]),X={class:"flex items-center justify-between"},Y={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 p-4 bg-muted/50 rounded-lg"},Z={class:"space-y-2"},$={class:"space-y-2"},ee={class:"flex items-end"},ae={key:0,class:"flex flex-wrap gap-2 mb-4"},te={key:1,class:"flex flex-col items-center justify-center py-12 text-center"},le={class:"text-xl font-semibold mb-2"},se={class:"text-sm text-muted-foreground"},de={key:2,class:"space-y-8"},oe={class:"text-sm font-semibold text-primary ml-8"},ue={class:"relative space-y-6"},ie={class:"flex flex-col items-center"},re={key:0,class:"w-0.5 flex-1 bg-border mt-2"},ne={class:"flex-1 pb-6"},ce={class:"flex items-center justify-between mb-3"},me={class:"flex items-center gap-2"},fe={class:"text-xs text-muted-foreground"},ve={class:"font-medium mb-1"},pe={key:0,class:"flex items-center gap-1 text-xs text-muted-foreground"},ye={key:0,class:"md:border-l md:pl-4"},xe={class:"text-xs font-medium text-muted-foreground mb-2"},ge={class:"flex flex-wrap gap-1"},_e={class:"space-y-4"},he={class:"grid grid-cols-2 gap-4 p-4 bg-muted/50 rounded-lg"},be={class:"text-sm font-semibold"},we={key:0},ke={class:"text-sm font-semibold mb-3"},De={class:"border rounded-md"},Me={key:1},je={class:"flex items-center justify-between mb-3"},Ae={class:"text-sm font-semibold"},Ce={key:0,class:"p-4 text-center text-sm text-muted-foreground"},Ve={key:1,class:"space-y-4"},Te={class:"font-medium text-sm mb-3"},Se={class:"flex items-center gap-4"},Le={class:"flex-1 space-y-1"},Be={class:"p-3 rounded bg-muted border"},Ne={class:"text-sm line-through opacity-70"},ze={class:"flex items-center justify-center pt-5"},He={class:"flex-1 space-y-1"},Re={class:"p-3 rounded bg-accent border"},Ee={class:"text-sm font-medium"},Fe={class:"group"},Ue={class:"mt-3 border rounded-md"},qe={__name:"HistoryTimeline",setup(e){const qe=a(),Oe=t(!1),Ie=t(null),Pe=t({nomeMetadado:"",unidade:"__all__"}),Ke={unidade:"Unidade",metadadoDeProcesso:"Metadado de Processo",tipoDocumento:"Tipos de Documento",nomeMetadado:"Nome do Metadado",objetivoMetadado:"Objetivo",formatoMetadado:"Formato",admiteMultiplos:"Admite Múltiplos",tipoMetadados:"Tipo de Metadados",versaoInicialAtende:"Versão Inicial Atende",observacao:"Observação"},Ge=l(()=>{let e=qe.history;if(Pe.value.nomeMetadado.trim()){const a=Pe.value.nomeMetadado.toLowerCase();e=e.filter(e=>(e.data?.nomeMetadado||e.oldData?.nomeMetadado||"").toLowerCase().includes(a))}return Pe.value.unidade&&"__all__"!==Pe.value.unidade&&(e=e.filter(e=>(e.data?.unidade||e.oldData?.unidade)===Pe.value.unidade)),e}),Je=l(()=>{const e=new Set;return qe.history.forEach(a=>{const t=a.data?.unidade||a.oldData?.unidade;t&&e.add(t)}),Array.from(e).sort()}),Qe=l(()=>""!==Pe.value.nomeMetadado.trim()||""!==Pe.value.unidade&&"__all__"!==Pe.value.unidade);function We(){Pe.value.nomeMetadado="",Pe.value.unidade="__all__"}const Xe=l(()=>{const e={};return Ge.value.forEach(a=>{const t=new Date(a.timestamp),l=t.toLocaleDateString("pt-BR");e[l]||(e[l]={date:l,dateFormatted:Ye(t),items:[]}),e[l].items.push(a)}),Object.values(e).sort((e,a)=>{const t=new Date(e.items[0].timestamp);return new Date(a.items[0].timestamp)-t})});function Ye(e){const a=new Date,t=new Date(a);t.setDate(t.getDate()-1);const l=e.toLocaleDateString("pt-BR"),s=a.toLocaleDateString("pt-BR"),d=t.toLocaleDateString("pt-BR");return l===s?"Hoje":l===d?"Ontem":l}function Ze(e){if("update"!==e.type||!e.oldData||!e.data)return[];const a=[];return Object.keys(Ke).forEach(t=>{var l,s;l=e.oldData[t],s=e.data[t],(Array.isArray(l)&&Array.isArray(s)?l.length===s.length&&l.every((e,a)=>e===s[a]):l===s)||a.push({field:t,label:Ke[t],oldValue:e.oldData[t],newValue:e.data[t]})}),a}function $e(e){return null==e?"-":"boolean"==typeof e?e?"Sim":"Não":Array.isArray(e)?e.length>0?e.join(", "):"-":"string"==typeof e&&""===e.trim()?"-":e}function ea(e){switch(e){case"create":return Q;case"update":return W;case"delete":return G;default:return g}}function aa(e){switch(e){case"create":return"Criado";case"update":return"Atualizado";case"delete":return"Excluído";default:return"Desconhecido"}}return(e,a)=>(d(),s(i(j),null,{default:o(()=>[u(i(k),null,{default:o(()=>[r("div",X,[u(i(D),null,{default:o(()=>[...a[6]||(a[6]=[n("Histórico de Alterações",-1)])]),_:1}),u(i(c),{variant:"secondary",class:"text-xs"},{default:o(()=>[n(m(Ge.value.length)+" de "+m(i(qe).history.length)+" registros ",1)]),_:1})])]),_:1}),u(i(M),null,{default:o(()=>[r("div",Y,[r("div",Z,[u(i(L),{for:"filter-nome"},{default:o(()=>[...a[7]||(a[7]=[n("Nome do Metadado",-1)])]),_:1}),u(i(A),{id:"filter-nome",modelValue:Pe.value.nomeMetadado,"onUpdate:modelValue":a[0]||(a[0]=e=>Pe.value.nomeMetadado=e),placeholder:"Buscar por nome...",class:"w-full"},null,8,["modelValue"])]),r("div",$,[u(i(L),{for:"filter-unidade"},{default:o(()=>[...a[8]||(a[8]=[n("Unidade",-1)])]),_:1}),u(i(B),{modelValue:Pe.value.unidade,"onUpdate:modelValue":a[1]||(a[1]=e=>Pe.value.unidade=e)},{default:o(()=>[u(i(N),{id:"filter-unidade"},{default:o(()=>[u(i(z),{placeholder:"Todas as unidades"})]),_:1}),u(i(H),null,{default:o(()=>[u(i(R),{value:"__all__"},{default:o(()=>[...a[9]||(a[9]=[n("Todas as unidades",-1)])]),_:1}),(d(!0),f(p,null,y(Je.value,e=>(d(),s(i(R),{key:e,value:e},{default:o(()=>[n(m(e),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["modelValue"])]),r("div",ee,[u(i(x),{variant:"outline",class:"w-full",onClick:We,disabled:!Qe.value},{default:o(()=>[u(i(E),{class:"w-4 h-4 mr-2"}),a[10]||(a[10]=n(" Limpar Filtros ",-1))]),_:1},8,["disabled"])])]),Qe.value?(d(),f("div",ae,[Pe.value.nomeMetadado?(d(),s(i(c),{key:0,variant:"secondary",class:"gap-1"},{default:o(()=>[n(" Nome: "+m(Pe.value.nomeMetadado)+" ",1),r("button",{onClick:a[2]||(a[2]=e=>Pe.value.nomeMetadado=""),class:"ml-1 hover:text-destructive"},[u(i(E),{class:"w-3 h-3"})])]),_:1})):v("",!0),Pe.value.unidade&&"__all__"!==Pe.value.unidade?(d(),s(i(c),{key:1,variant:"secondary",class:"gap-1"},{default:o(()=>[n(" Unidade: "+m(Pe.value.unidade)+" ",1),r("button",{onClick:a[3]||(a[3]=e=>Pe.value.unidade="__all__"),class:"ml-1 hover:text-destructive"},[u(i(E),{class:"w-3 h-3"})])]),_:1})):v("",!0)])):v("",!0),0===Xe.value.length?(d(),f("div",te,[u(i(g),{class:"w-16 h-16 text-muted-foreground mb-4"}),r("h3",le,m(Qe.value?"Nenhum resultado encontrado":"Nenhuma alteração registrada"),1),r("p",se,m(Qe.value?"Tente ajustar os filtros de busca":"As ações realizadas aparecerão aqui"),1)])):(d(),f("div",de,[(d(!0),f(p,null,y(Xe.value,e=>(d(),f("div",{key:e.date,class:"space-y-4"},[r("div",oe,m(e.dateFormatted),1),r("div",ue,[(d(!0),f(p,null,y(e.items,(t,l)=>(d(),f("div",{key:t.id,class:"relative flex gap-4"},[r("div",ie,[r("div",{class:_(["w-8 h-8 rounded-full flex items-center justify-center z-10",(t.type,"bg-primary")])},[(d(),s(h(ea(t.type)),{class:"w-4 h-4 text-white"}))],2),l<e.items.length-1?(d(),f("div",re)):v("",!0)]),r("div",ne,[u(i(j),{class:_((t.type,""))},{default:o(()=>[u(i(M),{class:"p-4"},{default:o(()=>{return[r("div",ce,[r("div",me,[u(i(c),{variant:(t.type,"secondary")},{default:o(()=>[n(m(aa(t.type)),1)]),_:2},1032,["variant"]),r("span",fe,m((e=t.timestamp,new Date(e).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}))),1)]),u(i(x),{variant:"ghost",size:"sm",onClick:e=>function(e){Ie.value=e,Oe.value=!0}(t)},{default:o(()=>[...a[11]||(a[11]=[n(" Detalhes ",-1)])]),_:1},8,["onClick"])]),r("div",{class:_("update"===t.type?"grid grid-cols-1 md:grid-cols-2 gap-4":"")},[r("div",null,[r("div",ve,m(t.data?.nomeMetadado||t.oldData?.nomeMetadado||"Sem nome"),1),t.data?.unidade?(d(),f("div",pe,[u(i(K),{class:"w-3 h-3"}),n(" "+m(t.data.unidade),1)])):v("",!0)]),"update"===t.type?(d(),f("div",ye,[r("div",xe," Campos alterados ("+m(Ze(t).length)+") ",1),r("div",ge,[(d(!0),f(p,null,y(Ze(t).slice(0,5),e=>(d(),s(i(c),{key:e.field,variant:"outline",class:"text-xs"},{default:o(()=>[n(m(e.label),1)]),_:2},1024))),128)),Ze(t).length>5?(d(),s(i(c),{key:0,variant:"outline",class:"text-xs"},{default:o(()=>[n(" +"+m(Ze(t).length-5)+" mais ",1)]),_:2},1024)):v("",!0)])])):v("",!0)],2)];var e}),_:2},1024)]),_:2},1032,["class"])])]))),128))])]))),128))]))]),_:1}),u(i(F),{open:Oe.value,"onUpdate:open":a[5]||(a[5]=e=>Oe.value=e)},{default:o(()=>[Ie.value?(d(),s(i(U),{key:0,class:"max-w-4xl max-h-[90vh] overflow-y-auto"},{default:o(()=>[u(i(q),null,{default:o(()=>[u(i(O),{class:"flex items-center gap-2"},{default:o(()=>[(d(),s(h(ea(Ie.value.type)),{class:"w-5 h-5"})),n(" "+m(aa(Ie.value.type))+" - Detalhes Completos ",1)]),_:1})]),_:1}),r("div",_e,[r("div",he,[r("div",null,[a[12]||(a[12]=r("p",{class:"text-sm font-medium text-muted-foreground"},"Data/Hora",-1)),r("p",be,m(new Date(Ie.value.timestamp).toLocaleString("pt-BR")),1)]),r("div",null,[a[13]||(a[13]=r("p",{class:"text-sm font-medium text-muted-foreground"},"Tipo de Ação",-1)),u(i(c),{variant:(Ie.value.type,"secondary")},{default:o(()=>[n(m(aa(Ie.value.type)),1)]),_:1},8,["variant"])])]),u(i(P)),"update"!==Ie.value.type?(d(),f("div",we,[r("h4",ke," Dados "+m("delete"===Ie.value.type?"Excluídos":"Criados"),1),r("div",De,[u(i(C),null,{default:o(()=>[u(i(V),null,{default:o(()=>[(d(),f(p,null,y(Ke,(e,a)=>u(i(T),{key:a},{default:o(()=>[u(i(S),{class:"font-medium w-1/3"},{default:o(()=>[n(m(e)+":",1)]),_:2},1024),u(i(S),null,{default:o(()=>[n(m($e("delete"===Ie.value.type?Ie.value.oldData?.[a]:Ie.value.data?.[a])),1)]),_:2},1024)]),_:2},1024)),64))]),_:1})]),_:1})])])):v("",!0),"update"===Ie.value.type?(d(),f("div",Me,[r("div",je,[r("h4",Ae," Campos Alterados ("+m(Ze(Ie.value).length)+") ",1),u(i(c),{variant:"outline"},{default:o(()=>[n(m(Ze(Ie.value).length)+" modificações ",1)]),_:1})]),0===Ze(Ie.value).length?(d(),f("div",Ce," Nenhum campo foi alterado ")):(d(),f("div",Ve,[(d(!0),f(p,null,y(Ze(Ie.value),e=>(d(),f("div",{key:e.field,class:"border rounded-lg p-4"},[r("div",Te,m(e.label),1),r("div",Se,[r("div",Le,[a[14]||(a[14]=r("div",{class:"text-xs text-muted-foreground font-medium"},"Valor Anterior",-1)),r("div",Be,[r("span",Ne,m($e(e.oldValue)),1)])]),r("div",ze,[u(i(J),{class:"w-5 h-5 text-muted-foreground flex-shrink-0"})]),r("div",He,[a[15]||(a[15]=r("div",{class:"text-xs text-muted-foreground font-medium"},"Valor Novo",-1)),r("div",Re,[r("span",Ee,m($e(e.newValue)),1)])])])]))),128))])),u(i(P),{class:"my-4"}),r("details",Fe,[a[16]||(a[16]=r("summary",{class:"cursor-pointer text-sm font-medium text-muted-foreground hover:text-foreground"}," Ver campos não alterados ",-1)),r("div",Ue,[u(i(C),null,{default:o(()=>[u(i(V),null,{default:o(()=>[(d(),f(p,null,y(Ke,(e,a)=>b(u(i(T),{key:a},{default:o(()=>[u(i(S),{class:"font-medium w-1/3"},{default:o(()=>[n(m(e)+":",1)]),_:2},1024),u(i(S),null,{default:o(()=>[n(m($e(Ie.value.data?.[a])),1)]),_:2},1024)]),_:2},1024),[[w,!Ze(Ie.value).some(e=>e.field===a)]])),64))]),_:1})]),_:1})])])])):v("",!0)]),u(i(I),null,{default:o(()=>[u(i(x),{variant:"ghost",onClick:a[4]||(a[4]=e=>Oe.value=!1)},{default:o(()=>[...a[17]||(a[17]=[n(" Fechar ",-1)])]),_:1})]),_:1})]),_:1})):v("",!0)]),_:1},8,["open"])]),_:1}))}},Oe={class:"space-y-6"},Ie={__name:"Historico",setup:e=>(e,a)=>(d(),f("div",Oe,[a[0]||(a[0]=r("h1",{class:"text-3xl font-bold"},"Histórico de Alterações",-1)),u(qe)]))};
/**
 * @license lucide-vue-next v0.548.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */export{Ie as default};
